<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Cat√°logo de Cursos Superiores em Institui√ß√µes P√∫blicas no ES</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.23/jspdf.plugin.autotable.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.2/dist/confetti.browser.min.js"></script>
  
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background-color: #f4f9ff;
      color: #333;
      margin: 0;
      padding: 0;
    }

    header {
      background-color: #003366;
      color: white;
      padding: 1rem;
      text-align: center;
    }

    main {
      padding: 2rem;
    }

    .filtros {
      display: flex;
      flex-wrap: wrap;
      gap: 1rem;
      margin-bottom: 2rem;
    }

    .filtros input,
    .filtros select {
      padding: 0.5rem;
      font-size: 1rem;
      border-radius: 4px;
      border: 1px solid #ccc;
    }

    .card-container {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
      gap: 1.5rem;
      min-height: 50vh;
    }

    .card {
      background-color: white;
      border-radius: 8px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
      overflow: hidden;
      display: flex;
      flex-direction: column; /* Organiza o conte√∫do do card em coluna */
      transition: transform 0.2s ease, opacity 0.3s ease; /* Transi√ß√£o mais simples */
      opacity: 1;
    }

    .card:hover {
      transform: scale(1.03);
    }

    .card img {
      width: 100%;
      height: 140px;
      object-fit: cover;
    }

    .card-content {
      padding: 1rem;
      flex-grow: 1; /* <-- ESTA √â A PROPRIEDADE M√ÅGICA QUE IGUALA AS ALTURAS */
    }

    .card-content h2 {
      font-size: 1.1rem;
      margin: 0 0 0.5rem;
    }

    .card-content p {
      font-size: 0.95rem;
      margin: 0;
    }
    
    .modal {
      display: none;
      position: fixed;
      z-index: 1000;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      overflow-y: auto;
      background-color: rgba(0,0,0,0.8);
    }

    .modal-content {
      background-color: #fff;
      margin: 5% auto;
      padding: 2rem;
      max-width: 600px;
      border-radius: 10px;
      position: relative;
    }

    .close {
      color: #aaa;
      position: absolute;
      top: 10px;
      right: 20px;
      font-size: 1.5rem;
      cursor: pointer;
    }

    iframe {
      width: 100%;
      height: 315px;
      border: none;
      margin-top: 1rem;
    }

    @media (max-width: 600px) {
      iframe {
        height: 200px;
      }
    }
     @media (max-width: 600px) { /* Esta √© a media query para telas menores que 600px */
¬† ¬† ¬† iframe {
¬† ¬† ¬† ¬† height: 200px;
¬† ¬† ¬† }

      .card-container {
        grid-template-columns: repeat(2, 1fr); /* 2 colunas */
        gap: 1rem; /* Espa√ßamento entre os cards */
      }

      /* Ajustes opcionais para o conte√∫do dos cards em telas menores */
      .card-content h2 {
        font-size: 1rem; /* Fonte menor para o t√≠tulo */
      }
      .card-content p {
        font-size: 0.85rem; /* Fonte menor para os par√°grafos */
      }
¬† ¬† }
    
    /* Ajustes para o Wrapper do √çcone e Logo */
    .card-icon-wrapper {
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 1rem;
      gap: 1.5rem;
      min-height: 80px;
    }
    
    .card-icon {
      font-size: 64px;
      color: #003366;
      flex-shrink: 0; /* O √çCONE n√£o deve encolher */
    }
    
    .institution-logo {
      /* 1. Define um LIMITE M√ÅXIMO, n√£o um tamanho fixo */
      max-width: 60px;
      max-height: 60px;
    
      /* 2. Garante que a imagem ocupe o espa√ßo dispon√≠vel sem distorcer */
      width: 100%;
      height: auto;
      
      /* 3. Garante que a imagem caiba INTEIRA dentro do espa√ßo, sem cortar */
      object-fit: contain; 
      
      /* 4. Impede a imagem de ser "esmagada" pelo √≠cone ao lado */
      flex-shrink: 0;
    }

      /* --- ESTILOS PARA O MODO ELIMINE E FAVORITE --- */
      
      /* Esconde as a√ß√µes do card por padr√£o */
      .card-actions {
        display: none;
        justify-content: space-around;
        padding: 0.5rem 0;
        border-top: 1px solid #eee; /* Uma linha para separar */
        margin-top: 0.5rem;
      }
      /* MOSTRA as a√ß√µes quando o modo est√° ativo */
      body.modo-edicao-ativo .card-actions {
        display: flex;
      }
      /* Estilo dos bot√µes de a√ß√£o (estrela e proibido) */
      .card-actions button {
        background: none;
        border: none;
        cursor: pointer;
        font-size: 32px; /* Tamanho grande para toque */
        color: #ccc; /* Come√ßam cinza, sem cor */
        transition: transform 0.2s ease, color 0.2s ease;
        padding: 0 1rem; /* Adiciona espa√ßo para facilitar o clique */
      }
      /* Efeito ao passar o mouse ou tocar */
      .card-actions button:hover {
        transform: scale(1.2);
      }
      /* Estilo para a estrela favoritada */
      .card-actions button.favorito-ativo .material-symbols-outlined {
        color: #ffc107; /* Amarelo ouro */
        font-variation-settings: 'FILL' 1; /* Transforma o contorno em preenchido */
      }
      
      /* --- ESTILOS DOS CONTROLES NO MENU DE FILTROS --- */
      
      /* Estilo para o bot√£o principal de ligar/desligar o modo */
      #toggle-edit-mode {
        display: flex;
        align-items: center;
        gap: 8px;
        padding: 10px 15px;
        background-color: #6c757d;
        color: white;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        font-size: 1rem;
      }
      #toggle-edit-mode.active {
        background-color: #0056b3;
      }

      #reset-filtros-btn,
      #curso-surpresa-btn {
        background-color: #6c757d; /* Cinza, como o bot√£o de Edi√ß√£o */
        color: white;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        padding: 8px; /* Um pouco menor para ser mais discreto */
        display: flex;
        align-items: center;
        justify-content: center;
      }
      /* Container para os bot√µes de Favoritos, Lixeira, etc. */
      .edit-actions-container {
        display: none; /* Escondido por padr√£o */
        gap: 10px;
        margin-left: auto; /* Empurra para a direita */
      }
      /* Mostra o container quando o modo de edi√ß√£o est√° ativo */
      body.modo-edicao-ativo .edit-actions-container {
        display: flex;
      }
      .edit-actions-container button {
        display: flex;
        align-items: center;
        gap: 8px;
        padding: 10px 15px;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        font-size: 1rem;
        background-color: #f0f0f0;
      }
      .edit-actions-container button.danger {
        background-color: #dc3545; /* Vermelho perigo */
        color: white;
      }

      .container-lista {
        max-height: 60vh;
        overflow-y: auto;
        margin-top: 1rem;
      }
      .card-lista {
        display: flex;
        align-items: center;
        padding: 0.5rem;
        border-bottom: 1px solid #eee;
      }
      .card-content-lista {
        flex-grow: 1;
      }
      .card-content-lista h2 {
        font-size: 1rem;
        margin: 0;
      }
      .card-content-lista p {
        font-size: 0.9rem;
        margin: 0;
      }
      .card-icon-lista {
        margin-right: 1rem;
        color: #003366;
      }
      .card-actions-lista button {
          background: none;
          border: none;
          cursor: pointer;
          font-size: 1.5rem;
      }
      .card-clickable-area {
        cursor: pointer; /* Transforma o cursor em "m√£ozinha" ao passar por cima */
        flex-grow: 1;
        display: flex;
        flex-direction: column;
      }
      /* Define a anima√ß√£o de fade-out */
       @keyframes fadeOutAndShrink {
         to {
          opacity: 0;
          transform: scale(0.8); /* Encolhe para 80% do tamanho */
        }
      }
      
      .card.eliminando {
        animation: fadeOutAndShrink 0.25s forwards;
        pointer-events: none;
      }

      /* Estilo para o bot√£o de Imprimir */
      #print-button {
        display: flex;
        align-items: center;
        gap: 8px;
        padding: 10px 15px;
        background-color: #28a745; /* Verde para destacar a a√ß√£o */
        color: white;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        font-size: 1rem;
      }
      
      /* Estilos para as op√ß√µes dentro do modal de impress√£o */
      .print-options {
        display: flex;
        flex-direction: column;
        gap: 0.75rem;
        margin-bottom: 1rem;
      }
      .print-options label {
        display: flex;
        align-items: center;
        gap: 8px;
        cursor: pointer;
      }
      .print-actions {
        margin-top: 2rem;
        display: flex;
        justify-content: flex-end; /* Alinha os bot√µes √† direita */
        gap: 1rem;
      }
      .print-actions button {
        padding: 10px 20px;
        border: none;
        border-radius: 5px;
        font-size: 1rem;
        cursor: pointer;
      }
      .print-actions .confirm-btn {
        background-color: #0056b3;
        color: white;
      }
      .print-actions .cancel-btn {
        background-color: #ccc;
      }

      /* Container para os bot√µes de a√ß√£o DENTRO do modal */
      .modal-actions {
        margin-top: 1.5rem;
        padding-top: 1rem;
        border-top: 1px solid #eee;
        display: flex;
        justify-content: space-around;
        gap: 1rem;
      }
      .modal-actions button {
        background-color: #f0f0f0;
        border: 1px solid #ccc;
        border-radius: 5px;
        padding: 10px 15px;
        cursor: pointer;
        font-size: 1rem;
        display: flex;
        align-items: center;
        gap: 8px;
        transition: background-color 0.2s ease;
      }
      .modal-actions button:hover {
        background-color: #e0e0e0;
      }
      @keyframes pulse {
        0% { transform: scale(1); }
        50% { transform: scale(1.1); }
        100% { transform: scale(1); }
      }
      /* Regra de Ouro para a Estrela Amarela */
      .favorito-ativo,
      .favorito-ativo .material-symbols-outlined {
        color: #ffc107 !important; /* Amarelo-ouro */
      }
      /* Ajuste no conte√∫do do modal para servir de √¢ncora para a logo */
      .modal-content {
        position: relative; /* Essencial para o posicionamento da logo */
      }
      
      /* Container para o t√≠tulo e o √≠cone do curso */
      .modal-title-container {
        display: flex;
        align-items: center;
        gap: 0.5em; /* Espa√ßo entre o √≠cone e o t√≠tulo */
        margin-right: 70px; /* Garante espa√ßo para a logo n√£o sobrepor o t√≠tulo */
      }
      
      /* Estilo do √≠cone do curso no t√≠tulo do modal */
      .modal-title-icon {
        font-size: 1.6em;
        color: #003366;    /* Mant√©m a cor azul do card */
      }
      
      /* Estilo e posicionamento da logo da institui√ß√£o no modal */
      .modal-institution-logo {
        max-width: 60px;  /* Mesmo tamanho m√°ximo do card */
        max-height: 60px;
        object-fit: contain;
      }
    .modal-info-container {
      display: flex;
      flex-wrap: wrap; /* Permite que os itens quebrem a linha em telas menores */
      justify-content: space-between; /* Empurra a logo para a direita */
      align-items: center; /* Alinha verticalmente os itens */
    }
    .modal-info-container p {
      flex-basis: 70%; /* Os par√°grafos ocupam 70% da largura, deixando 30% para a logo */
    }
  </style>
</head>
<body>
  <header>
    <h1 id="site-title">Cat√°logo de Cursos Superiores em Institui√ß√µes P√∫blicas no ES</h1>
  </header>

  <main>
    <section class="filtros" aria-label="Filtros de busca">
        <input type="text" id="busca" placeholder="Nome do curso" aria-label="Busca por nome do curso">
        <select id="instituicao" aria-label="Institui√ß√£o">
          <option value="">Todas as institui√ß√µes</option>
        </select>
        <select id="tipo" aria-label="Tipo de curso">
          <option value="">Todos os tipos</option>
        </select>
        <select id="campus" aria-label="Campus">
          <option value="">Todos os campi</option>
        </select>
        <select id="duracao" aria-label="Dura√ß√£o">
          <option value="">Todas as dura√ß√µes</option>
        </select>
        <button id="reset-filtros-btn" title="Limpar filtros">
          <span class="material-symbols-outlined">restart_alt</span>
        </button>
        <button id="curso-surpresa-btn" title="Curso surpresa! (filtros se aplicam)">
          <span class="material-symbols-outlined">casino</span>
        </button>
        <button id="toggle-edit-mode">
          <span class="material-symbols-outlined">tune</span>
          Elimine e Favorite
        </button>
    
        <button id="print-button">
          <span class="material-symbols-outlined">print</span>
          Imprimir Rela√ß√£o
        </button>
    
        <div id="edit-actions" class="edit-actions-container">
          <button id="show-favorites">‚≠ê Favoritos</button>
          <button id="show-eliminated">üóëÔ∏è Lixeira</button>
          <button id="show-sorteados-btn" style="display: none;">üé≤ Sorteados</button> 
          <button id="clear-lists" class="danger">Limpar Tudo</button>
        </div>
    </section>

    <p id="contador-cursos" style="font-weight:bold; margin-bottom:1rem;">Exibindo 0 cursos com os filtros selecionados</p>
    
    <section id="cards" class="card-container" aria-label="Lista de cursos"></section>
    <div id="loading" class="loading-indicator">Carregando mais cursos...</div>
    <div id="loader" style="text-align:center; display:none; margin:2rem 0; font-style:italic; color:#555;">
      Carregando mais cursos...
    </div>

  </main>

  <div id="modals"></div>

  <div id="print-modal" class="modal">
    <div class="modal-content">
      <span class="close" onclick="fecharModal('print-modal')">&times;</span>
      <h2>Op√ß√µes de Impress√£o</h2>
      <p>Voc√™ gostaria de imprimir:</p>
      <div class="print-options">
        <label><input type="checkbox" id="print-favoritos" checked> Favoritos</label>
        <label><input type="checkbox" id="print-emduvida" checked> Em d√∫vida</label>
        <label><input type="checkbox" id="print-eliminados"> Eliminados</label>
      </div>
  
      <p style="margin-top: 1.5rem;">Considerar os cursos na tela:</p>
      <div class="print-options">
        <label><input type="radio" name="print-source" id="print-source-todos" value="todos" required> Ignorar filtros ativos</label>
        <label><input type="radio" name="print-source" id="print-source-filtrados" value="filtrados" required> Usar apenas cursos filtrados</label>
      </div>
  
      <div class="print-actions">
        <button class="cancel-btn" onclick="fecharModal('print-modal')">Cancelar</button>
        <button class="confirm-btn" id="generate-pdf-btn">Gerar PDF</button>
      </div>
    </div>
  </div>
  
<script>
    // Vari√°veis globais para controlar o estado da p√°gina
    let cursos = [];
    let cursosFiltrados = [];
    let offset = 0;
    const BATCH_SIZE = 20;
    const limit = 20;
    let carregando = false;
    let modoEdicaoAtivo = false;

    // --- FUN√á√ïES DE RENDERIZA√á√ÉO E UI (Todas juntas e organizadas) ---

    function criarCard(curso) {
        const nomeIcone = getIconeParaCurso(curso.Curso);
        const logoUrl = getLogoParaInstituicao(curso.Institui√ß√£o);
        const classeFavorito = curso.isFavorito ? 'favorito-ativo' : '';
        const iconeEstrela = curso.isFavorito ? 'star' : 'star_border';
        
        return `
        <article class="card" id="card-${curso.id}">
        <div class="card-clickable-area" onclick="abrirModalDeCurso(${curso.id})">
            
            <div class="card-icon-wrapper">
              <span class="material-symbols-outlined card-icon">${nomeIcone}</span>
              ${logoUrl ? `<img src="${logoUrl}" alt="Logo ${curso.Institui√ß√£o}" class="institution-logo">` : ''}
            </div>
    
            <div class="card-content">
              <h2>${curso.Curso}</h2>
              <p><strong>Institui√ß√£o:</strong> ${curso.Institui√ß√£o || 'N/A'}</p>
              <p><strong>Campus:</strong> ${curso.Campus}</p>
              <p><strong>Tipo:</strong> ${curso.Tipo}</p>
              <p><strong>Dura√ß√£o:</strong> ${curso.Semestres} semestres</p>
            </div>
          </div>
          <div class="card-actions">
            <button title="Favoritar curso" class="${classeFavorito}" onclick="toggleFavorito(${curso.id})">
              <span class="material-symbols-outlined">${iconeEstrela}</span>
            </button>
            <button title="Eliminar curso" onclick="toggleEliminado(${curso.id})">üö´</button>
          </div>
        </article>`;
    }

    function criarModal(curso, contexto = 'normal') {
        const nomeIcone = getIconeParaCurso(curso.Curso);
        const arquivoLogo = getLogoParaCurso(curso.Institui√ß√£o);
    
        let actionsHTML = '';
        if (contexto === 'edicao') {
            const classeFavorito = curso.isFavorito ? 'favorito-ativo' : '';
            const iconeEstrela = curso.isFavorito ? 'star' : 'star_border';
            actionsHTML = `
            <div class="modal-actions">
                <button class="${classeFavorito}" onclick="toggleFavorito(${curso.id})"><span class="material-symbols-outlined">${iconeEstrela}</span> Favoritar</button>
                <button onclick="toggleEliminado(${curso.id}); fecharModal('modal-${curso.id}')">üö´ Eliminar</button>
            </div>`;
        } else if (contexto === 'sorteio') {
            const classeFavorito = curso.isFavorito ? 'favorito-ativo' : '';
            const iconeEstrela = curso.isFavorito ? 'star' : 'star_border';
            actionsHTML = `
            <div class="modal-actions">
                <button class="${classeFavorito}" onclick="acaoFavoritarSorteado(${curso.id})"><span class="material-symbols-outlined">${iconeEstrela}</span> Favoritar</button>
                <button onclick="sortearCursoSurpresa(true)">üé≤ Sortear Novo</button>
                <button onclick="acaoEliminarSorteado(${curso.id})">üö´ Eliminar e Sortear</button>
            </div>`;
        }
    
        const formaDeAcessoComLink = transformarLinks(curso["Forma de acesso"]);
    
        return `
        <div id="modal-${curso.id}" class="modal">
          <div class="modal-content">
            <span class="close" onclick="fecharModal('modal-${curso.id}')">&times;</span>
            
            ${curso.VideoID ? `<iframe data-src="https://www.youtube.com/embed/${curso.VideoID}" title="YouTube video player" allowfullscreen></iframe>` : ''}
            
            <div class="modal-title-container">
              <span class="material-symbols-outlined modal-title-icon">${nomeIcone}</span>
              <h2>${curso.Curso}</h2>
            </div>
    
            <div class="modal-info-container"> <div> <p><strong>Tipo:</strong> ${curso.Tipo}</p>
                    <p><strong>Institui√ß√£o:</strong> ${curso.Institui√ß√£o || "UFES"}</p>
                </div>
                ${arquivoLogo ? `<img src="${arquivoLogo}" alt="Logo de ${curso.Institui√ß√£o || 'UFES'}" class="modal-institution-logo">` : ''}
            </div>
            
            <p><strong>Campus:</strong> ${curso.Campus}</p>
            <p><strong>Hor√°rio:</strong> ${curso.Hor√°rio}</p>
            <p><strong>Acesso:</strong> ${formaDeAcessoComLink}</p>
            <a href="${curso["P√°gina do curso"]}" target="_blank">Visitar a p√°gina do curso</a>
            ${actionsHTML} 
          </div>
        </div>`;
    }

    function abrirModalDeCurso(cursoId) {
        const contexto = modoEdicaoAtivo ? 'edicao' : 'normal';
        const curso = cursos.find(c => c.id === cursoId);
        if (!curso) return;
    
        const modalId = `modal-${curso.id}`;
        let modal = document.getElementById(modalId);
    
        if (!modal) {
            // Cria o modal com o contexto correto
            const modalHTML = criarModal(curso, contexto);
            document.getElementById('modals').insertAdjacentHTML('beforeend', modalHTML);
        } else {
            // Se o modal j√° existe, mas o contexto pode ter mudado, o melhor √© recri√°-lo
            modal.remove();
            const modalHTML = criarModal(curso, contexto);
            document.getElementById('modals').insertAdjacentHTML('beforeend', modalHTML);
        }
        
        abrirModal(modalId); // Chama a fun√ß√£o que apenas exibe o modal
    }
    
    function abrirModal(modalId) {
        const modal = document.getElementById(modalId);
        if (!modal) return;
        const iframe = modal.querySelector('iframe');
        if (iframe && !iframe.src) {
            iframe.src = iframe.getAttribute('data-src');
        }
        modal.style.display = "block";
    }

    function fecharModal(modalId) {
        const modal = document.getElementById(modalId);
        if (!modal) return;
        if (modalId === 'lista-modal') {
            modal.remove();
        } else {
            const iframe = modal.querySelector('iframe');
            if (iframe) {
                iframe.src = "";
            }
            modal.style.display = "none";
        }
    }

    function atualizarContagem() {
        const contador = document.getElementById('contador-cursos');
        const exibidos = document.getElementById('cards').childElementCount;
        contador.textContent = `Exibindo ${exibidos} de ${cursosFiltrados.length} cursos com os filtros selecionados`;
    }

    // --- FUN√á√ïES DE L√ìGICA E DADOS ---
    function salvarListas() {
        const favoritosIds = cursos.filter(c => c.isFavorito).map(c => c.id);
        const eliminadosIds = cursos.filter(c => c.isEliminado).map(c => c.id);
        const sorteadosIds = cursos.filter(c => c.isSorteado).map(c => c.id);
    
        localStorage.setItem('cursosFavoritos', JSON.stringify(favoritosIds));
        localStorage.setItem('cursosEliminados', JSON.stringify(eliminadosIds));
        localStorage.setItem('cursosSorteados', JSON.stringify(sorteadosIds));
    }
  
    function renderizarMaisCursos(recriarModaisVisiveis = false) {
        const container = document.getElementById('cards');
        const modalsContainer = document.getElementById('modals');
        const fimDaLista = offset + BATCH_SIZE;
        const cursosParaRenderizar = cursosFiltrados.slice(offset, fimDaLista);
    
        if (recriarModaisVisiveis) {
            // Apaga e recria APENAS os modais dos cards que j√° est√£o na tela
            modalsContainer.innerHTML = '';
            const cursosJaRenderizados = cursosFiltrados.slice(0, offset);
            cursosJaRenderizados.forEach(curso => {
                modalsContainer.insertAdjacentHTML('beforeend', criarModal(curso, modoEdicaoAtivo ? 'edicao' : 'normal'));
            });
        }
    
        cursosParaRenderizar.forEach(curso => {
            container.insertAdjacentHTML('beforeend', criarCard(curso));
            modalsContainer.insertAdjacentHTML('beforeend', criarModal(curso, modoEdicaoAtivo ? 'edicao' : 'normal'));
        });
    
        offset = fimDaLista;
        document.getElementById('loading').style.display = 'none';
        atualizarContagem();
        verificarECarregarMaisSeNecessario();
    }
    function sortearCursoSurpresa(isResorteio = false) {
        if (cursosFiltrados.length === 0) {
            alert('Nenhum curso corresponde aos filtros selecionados para o sorteio.');
            return;
        }
    
        // Se for um re-sorteio, fecha o modal anterior primeiro
        if (isResorteio) {
            const modalAberto = document.querySelector('.modal[id^="modal-"][style*="display: block"]');
            if (modalAberto) {
                fecharModal(modalAberto.id);
            }
        }
    
        const indiceAleatorio = Math.floor(Math.random() * cursosFiltrados.length);
        const cursoSorteado = cursosFiltrados[indiceAleatorio];
        const modalId = `modal-${cursoSorteado.id}`;
    
        // Marca como sorteado e salva
        cursoSorteado.isSorteado = true;
        salvarListas();
        document.getElementById('show-sorteados-btn').style.display = 'flex'; // Garante que o bot√£o da lista apare√ßa
    
        // --- L√ìGICA DA ANIMA√á√ÉO ---
        // 1. Cria e mostra o modal de suspense
        const suspenseModalHTML = `
        <div id="suspense-modal" class="modal" style="display: block; background-color: rgba(0,0,0,0.9);">
            <div class="modal-content" style="background: none; text-align: center; box-shadow: none;">
                <span style="font-size: 150px; color: #666; animation: pulse 1.5s infinite;">?</span>
            </div>
        </div>`;
        document.body.insertAdjacentHTML('beforeend', suspenseModalHTML);
    
        // 2. Espera 800ms para criar o suspense
        setTimeout(() => {
            // Remove o modal de suspense
            document.getElementById('suspense-modal').remove();
    
            // Cria o modal do curso no contexto de sorteio
            let modal = document.getElementById(modalId);
            if (modal) modal.remove(); // Remove o antigo para garantir que os bot√µes est√£o certos
            const modalHTML = criarModal(cursoSorteado, 'sorteio');
            document.getElementById('modals').insertAdjacentHTML('beforeend', modalHTML);
            
            // Abre o modal do curso
            abrirModal(modalId);
            
            // 3. Solta os confetes!
            confetti({
                particleCount: 150,
                spread: 90,
                origin: { y: 0.6 },
                zIndex: 9999
            });
        }, 800); // 800ms de suspense
    }
    function transformarLinks(texto) {
      if (!texto) return '';
    
      const urlRegex = /(https?:\/\/[^\s]+)/g;
      return texto.replace(urlRegex, (url) => `<a href="${url}" target="_blank">${url}</a>`);
    }
  
    function verificarECarregarMaisSeNecessario() {
      // Usamos um pequeno delay para garantir que o navegador j√° recalculou o layout
      setTimeout(() => {
        const temBarraDeRolagem = document.documentElement.scrollHeight > window.innerHeight;
        if (!temBarraDeRolagem && offset < cursosFiltrados.length && !carregando) {
          renderizarMaisCursos();
        }
      }, 400); // Um delay um pouco maior ap√≥s a anima√ß√£o de remo√ß√£o
    }

    /**
     * Popula um elemento <select> com op√ß√µes √∫nicas baseadas nos dados dos cursos.
     * @param {string} filtroId - O ID do elemento <select> no HTML (ex: 'instituicao').
     * @param {string} chave - O nome da propriedade no objeto do curso (ex: 'Institui√ß√£o').
     */
    function popularFiltro(filtroId, chave) {
      const selectElement = document.getElementById(filtroId);
      
      // 1. Pega todos os valores para a chave especificada.
      const valores = cursos.map(c => c[chave]);
      
      // 2. Filtra para ter apenas valores √∫nicos e remove quaisquer valores vazios/nulos.
      const valoresUnicos = [...new Set(valores)].filter(valor => valor);
      
      // 3. Ordena os valores (numericamente se forem n√∫meros, alfabeticamente caso contr√°rio).
      valoresUnicos.sort((a, b) => {
        if (typeof a === 'number' && typeof b === 'number') {
          return a - b; // Ordena√ß√£o num√©rica
        }
        return String(a).localeCompare(String(b)); // Ordena√ß√£o alfab√©tica
      });
      
      // 4. Cria e adiciona um <option> para cada valor √∫nico.
      valoresUnicos.forEach(valor => {
        const opt = document.createElement('option');
        opt.value = valor;
        // Adiciona "semestres" ao texto se for o filtro de dura√ß√£o
        opt.textContent = (filtroId === 'duracao') ? `${valor} semestres` : valor;
        selectElement.appendChild(opt);
      });
    }

    function normalizarTexto(texto) {
      if (!texto) return '';
      return texto.toString().toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g, "");
    }
  
    function filtrarCursos() {
        const texto = normalizarTexto(document.getElementById('busca').value);
        const inst = document.getElementById('instituicao').value;
        const tipo = document.getElementById('tipo').value;
        const campus = document.getElementById('campus').value;
        const duracao = document.getElementById('duracao').value;
        cursosFiltrados = cursos.filter(curso => {
            if (modoEdicaoAtivo && curso.isEliminado) {
                return false;
            }
            const instituicaoCurso = curso.Institui√ß√£o || "UFES";
         return (
              normalizarTexto(curso.Curso).includes(texto) &&
              (inst === "" || instituicaoCurso === inst) &&
              (tipo === "" || curso.Tipo === tipo) &&
              (campus === "" || curso.Campus === campus) &&
              (duracao === "" || curso.Semestres.toString() === duracao)
          );
        });
        offset = 0;
        document.getElementById('cards').innerHTML = "";
        document.getElementById('modals').innerHTML = "";
        renderizarMaisCursos();
    }

    function getLogoParaInstituicao(nomeInstituicao) {
        if (!nomeInstituicao) {
            return '';
        }
    
        const nome = nomeInstituicao.toUpperCase();
        // Agora usando seus arquivos locais na pasta /img
        if (nome === 'UFES') {
            return './img/logo_ufes_pequena.png';
        }
        if (nome === 'IFES') {
            return './img/logo_ifes_pequena.png';
        }
        if (nome === 'FAMES') {
            return './img/logo_fames_pequena.png';
        }
        return ''; // Retorna vazio para qualquer outra institui√ß√£o
    }
  
    function getIconeParaCurso(nomeDoCurso) {
        const nome = nomeDoCurso.toUpperCase();
        // Regras mais espec√≠ficas v√™m primeiro
        if (nome.includes('EDUCA√á√ÉO F√çSICA')) return 'sports_gymnastics'; // √çcone para Ed. F√≠sica
        if (nome.includes('F√çSICA')) return 'radio_button_checked'; // √çcone para F√≠sica (qu√¢ntica, etc.)
        if (nome.includes('ENGENHARIA')) return 'engineering';
        if (nome.includes('COMPUTA√á√ÉO') || nome.includes('SISTEMAS')) return 'computer';
        if (nome.includes('DIREITO')) return 'gavel';
        if (nome.includes('MEDICINA')) return 'local_hospital';
        if (nome.includes('ARQUITETURA')) return 'architecture';
        if (nome.includes('QU√çMICA')) return 'science';
        if (nome.includes('BIOL√ìGICAS') || nome.includes('BIOLOGIA')) return 'biotech';
        if (nome.includes('MATEM√ÅTICA')) return 'functions';
        if (nome.includes('LETRAS')) return 'translate';
        if (nome.includes('PEDAGOGIA') || nome.includes('EDUCA√á√ÉO')) return 'school';
        if (nome.includes('HIST√ìRIA')) return 'history_edu';
        if (nome.includes('GEOGRAFIA')) return 'public';
        if (nome.includes('FILOSOFIA')) return 'psychology';
        if (nome.includes('ARTES')) return 'palette';
        if (nome.includes('M√öSICA')) return 'music_note';
        if (nome.includes('ADMINISTRA√á√ÉO') || nome.includes('CI√äNCIAS CONT√ÅBEIS')) return 'account_balance';
        if (nome.includes('ECON√îMICAS') || nome.includes('ECONOMIA')) return 'trending_up';
        if (nome.includes('JORNALISMO') || nome.includes('COMUNICA√á√ÉO')) return 'newspaper';
        if (nome.includes('FARM√ÅCIA')) return 'medication';
        if (nome.includes('NUTRI√á√ÉO')) return 'nutrition';
        if (nome.includes('PSICOLOGIA')) return 'neurology';
        if (nome.includes('AGRONOMIA')) return 'eco';
        return 'book_4';
    }
    function getLogoParaCurso(instituicao) {
        const inst = instituicao || "UFES"; // Garante que UFES seja o padr√£o
        switch (inst.toUpperCase()) {
            case 'UFES':
                return 'img/logo_ufes_pequena.png';
            case 'IFES':
                return 'img/logo_ifes_pequena.png';
            case 'FAMES':
                return 'img/logo_fames_pequena.png';
            default:
                return ''; // Retorna vazio se n√£o encontrar
        }
    }
    // --- FUN√á√ïES PARA O MODO "ELIMINE E FAVORITE" ---

    function toggleFavorito(cursoId) {
        const curso = cursos.find(c => c.id === cursoId);
        if (!curso) return;
    
        const estavaEliminado = curso.isEliminado; // Guarda o estado anterior
    
        // L√≥gica principal
        curso.isFavorito = !curso.isFavorito;
        if (curso.isFavorito && curso.isEliminado) {
            curso.isEliminado = false;
        }
        salvarListas();
    
        // Atualiza√ß√£o visual centralizada (card e modal)
        const cardButton = document.querySelector(`#card-${cursoId} .card-actions button:first-child`);
        if (cardButton) {
            cardButton.classList.toggle('favorito-ativo', curso.isFavorito);
            cardButton.querySelector('.material-symbols-outlined').textContent = curso.isFavorito ? 'star' : 'star_border';
        }
        const modalButton = document.querySelector(`#modal-${cursoId} .modal-actions button:first-child`);
        if (modalButton) {
            modalButton.classList.toggle('favorito-ativo', curso.isFavorito);
            modalButton.querySelector('.material-symbols-outlined').textContent = curso.isFavorito ? 'star' : 'star_border';
        }
        
        // Se um curso foi restaurado da lixeira ao ser favoritado,
        // E NENHUM MODAL DE CURSO ESTIVER ABERTO, atualize a tela.
        const isModalDeCursoAberto = document.querySelector('.modal[id^="modal-"][style*="display: block"]');
        if (estavaEliminado && !isModalDeCursoAberto) {
            filtrarCursos();
        }
    }
    
    function toggleEliminado(cursoId) {
        const curso = cursos.find(c => c.id === cursoId);
        if (!curso) return;
    
        // A√ß√£o: Mudar o status de eliminado
        curso.isEliminado = !curso.isEliminado;
    
        // NOVA REGRA: Se o curso foi eliminado, ele N√ÉO PODE ser favorito.
        if (curso.isEliminado && curso.isFavorito) {
            curso.isFavorito = false;
            // E atualiza a estrelinha do card para refletir isso
            const cardButton = document.querySelector(`#card-${cursoId} .card-actions button:first-child`);
            if (cardButton) {
                cardButton.classList.remove('favorito-ativo');
                cardButton.querySelector('.material-symbols-outlined').textContent = 'star_border';
            }
        }
        
        salvarListas(); // Salva ambos os estados
    
        // O resto da l√≥gica de anima√ß√£o e remo√ß√£o continua igual...
        const cardElement = document.getElementById(`card-${cursoId}`);
        if (curso.isEliminado && cardElement) {
            cardElement.classList.add('eliminando');
            cardElement.addEventListener('animationend', () => {
                cardElement.remove();
                atualizarContagem();
                verificarECarregarMaisSeNecessario();
            }, { once: true });
        } else if (!curso.isEliminado) {
            filtrarCursos();
        }
    }

    function abrirModalDeLista(titulo, listaDeCursos, isLixeira = false, isSorteados = false) {
        const modalAntigo = document.getElementById('lista-modal');
        if (modalAntigo) modalAntigo.remove();
    
        let cardsHTML = '';
        if (listaDeCursos.length === 0) {
            cardsHTML = '<p>Nenhum curso aqui. A lista est√° vazia.</p>';
        } else {
            listaDeCursos.forEach(curso => {
                const nomeIcone = getIconeParaCurso(curso.Curso);
                let acaoBotao = '';
    
                if (isLixeira) {
                    acaoBotao = `<button title="Restaurar curso" onclick="restaurarCursoDaLixeira(${curso.id})">‚ôªÔ∏è</button>`;
                } else { // Para Favoritos e Sorteados
                    const classeFavorito = curso.isFavorito ? 'favorito-ativo' : '';
                    const iconeEstrela = curso.isFavorito ? 'star' : 'star_border'; 
                    const botaoEliminarRestaurar = curso.isEliminado
                        ? `<button title="Restaurar curso" onclick="toggleEliminadoDaLista(${curso.id}, ${isSorteados}, true)">‚ôªÔ∏è</button>`
                        : `<button title="Eliminar curso" onclick="toggleEliminadoDaLista(${curso.id}, ${isSorteados}, false)">üö´</button>`;
                    acaoBotao = `
                        <button title="Favoritar curso" class="${classeFavorito}" onclick="toggleFavoritoDaLista(${curso.id}, ${isSorteados})">
                            <span class="material-symbols-outlined">${iconeEstrela}</span>
                        </button>
                        ${botaoEliminarRestaurar}
                    `;
                }
                cardsHTML += `
                <article class="card-lista" id="lista-card-${curso.id}">
                  <span class="material-symbols-outlined card-icon-lista">${nomeIcone}</span>
                  <div class="card-content-lista"><h2>${curso.Curso}</h2><p>${curso.Campus}</p></div>
                  <div class="card-actions-lista">${acaoBotao}</div>
                </article>`;
            });
        }
    
        const botaoLimpar = isSorteados ? '<button onclick="limparListaSorteados()" class="danger" style="margin-top: 1rem; width: 100%;">Limpar Hist√≥rico de Sorteios</button>' : '';
    
        const modalHTML = `
        <div id="lista-modal" class="modal" style="display:block;">
          <div class="modal-content">
            <span class="close" onclick="fecharModal('lista-modal')">&times;</span>
            <h2>${titulo}</h2>
            <div class="container-lista">${cardsHTML}</div>
            ${botaoLimpar}
          </div>
        </div>`;
        document.body.insertAdjacentHTML('beforeend', modalHTML);
    }

    function removerFavoritoDaLista(cursoId) {
        toggleFavorito(cursoId);
        const cardNaLista = document.getElementById(`lista-card-${cursoId}`);
        if (cardNaLista) cardNaLista.remove();
    }

    function restaurarCursoDaLixeira(cursoId) {
        const curso = cursos.find(c => c.id === cursoId);
        if (!curso) return;
    
        // Apenas muda o estado e salva. N√£o chama mais toggleEliminado.
        curso.isEliminado = false; 
        salvarListas();
    
        // Remove o card da lista do modal da lixeira
        const cardNaLista = document.getElementById(`lista-card-${cursoId}`);
        if (cardNaLista) {
            cardNaLista.remove();
        }
        // For√ßa a re-filtragem dos cards na tela principal para o curso reaparecer
        filtrarCursos();
    }
    function acaoFavoritarSorteado(cursoId) {
        if (!modoEdicaoAtivo) {
            modoEdicaoAtivo = true;
            document.body.classList.add('modo-edicao-ativo');
            document.getElementById('toggle-edit-mode').classList.add('active');
        }
        // A fun√ß√£o toggleFavorito j√° √© inteligente o suficiente para atualizar
        // tanto o card quanto o modal. N√£o precisamos de mais nada aqui.
        toggleFavorito(cursoId);
    }
    
    function acaoEliminarSorteado(cursoId) {
        // Ativa o modo de edi√ß√£o se n√£o estiver ativo
        if (!modoEdicaoAtivo) {
            document.getElementById('toggle-edit-mode').click();
        }
        // Elimina o curso
        toggleEliminado(cursoId);
        
        // Fecha o modal atual e sorteia o pr√≥ximo
        fecharModal(`modal-${cursoId}`);
        sortearCursoSurpresa(true); // O 'true' indica que √© um re-sorteio
    }

    // --- INICIALIZA√á√ÉO DA P√ÅGINA ---
    document.addEventListener('DOMContentLoaded', () => {
        fetch('dados_cursos_ufes_atualizado.json')
            .then(response => response.json())
            .then(data => {
                // Carrega os IDs salvos do localStorage
                const favoritosSalvos = JSON.parse(localStorage.getItem('cursosFavoritos')) || [];
                const eliminadosSalvos = JSON.parse(localStorage.getItem('cursosEliminados')) || [];
                const sorteadosSalvos = JSON.parse(localStorage.getItem('cursosSorteados')) || [];
            
                data.sort((a, b) => a.Curso.localeCompare(b.Curso));
                
                // Adiciona os estados salvos aos cursos
                cursos = data.map((curso, index) => ({
                    ...curso,
                    id: index,
                    isFavorito: favoritosSalvos.includes(index),
                    isEliminado: eliminadosSalvos.includes(index),
                    isSorteado: sorteadosSalvos.includes(index) // <-- NOVA PROPRIEDADE
                }));
            
                // Se j√° houver cursos sorteados da √∫ltima visita, mostra o bot√£o da lista
                if (sorteadosSalvos.length > 0) {
                    document.getElementById('show-sorteados-btn').style.display = 'flex';
                }
    
                cursosFiltrados = [...cursos];
                
                // Popula os filtros dinamicamente com base nos dados carregados
                popularFiltro('instituicao', 'Institui√ß√£o');
                popularFiltro('tipo', 'Tipo');
                popularFiltro('campus', 'Campus');
                popularFiltro('duracao', 'Semestres');

                // Adiciona os 'escutadores' de eventos para os filtros
                document.getElementById('busca').addEventListener('input', filtrarCursos);
                document.getElementById('instituicao').addEventListener('change', filtrarCursos);
                document.getElementById('tipo').addEventListener('change', filtrarCursos);
                document.getElementById('campus').addEventListener('change', filtrarCursos);
                document.getElementById('duracao').addEventListener('change', filtrarCursos);
                document.getElementById('reset-filtros-btn').addEventListener('click', resetarFiltros);
                // Adiciona o 'escutador' para o bot√£o de curso surpresa
                document.getElementById('curso-surpresa-btn').addEventListener('click', sortearCursoSurpresa);
                // Para o bot√£o que exibe a lista de cursos j√° sorteados
                document.getElementById('show-sorteados-btn').addEventListener('click', mostrarListaSorteados);
                // Adiciona os 'escutadores' de eventos para o MODO DE EDI√á√ÉO
                const toggleButton = document.getElementById('toggle-edit-mode');
                toggleButton.addEventListener('click', () => {
                    modoEdicaoAtivo = !modoEdicaoAtivo;
                    document.body.classList.toggle('modo-edicao-ativo');
                    toggleButton.classList.toggle('active');
                    filtrarCursos();
                });
                document.getElementById('show-favorites').addEventListener('click', () => {
                    const favoritos = cursos.filter(c => c.isFavorito);
                    abrirModalDeLista('Meus Favoritos', favoritos);
                });
                document.getElementById('show-eliminated').addEventListener('click', () => {
                    const eliminados = cursos.filter(c => c.isEliminado);
                    abrirModalDeLista('Cursos na Lixeira', eliminados, true);
                });
                document.getElementById('clear-lists').addEventListener('click', () => {
                    if (confirm('Tem certeza que deseja limpar TODAS as suas listas (Favoritos, Lixeira e Sorteados)? Esta a√ß√£o n√£o pode ser desfeita.')) {
                        cursos.forEach(c => {
                            c.isFavorito = false;
                            c.isEliminado = false;
                            c.isSorteado = false;
                        });
                        salvarListas(); // Salva o estado limpo
                        filtrarCursos();
                    }
                });
                
                // Adiciona o listener para o bot√£o de Imprimir
                document.getElementById('print-button').addEventListener('click', () => {
                  abrirModal('print-modal');
                });
                // Adiciona o listener para o bot√£o "Gerar PDF" dentro do modal
                document.getElementById('generate-pdf-btn').addEventListener('click', () => {
                  gerarPDF(); 
                });

                renderizarMaisCursos(); // Carrega o primeiro lote de cursos
            })
            .catch(error => console.error('Erro fatal:', error));

        // Listeners Globais
        window.onclick = function(event) {
            if (event.target.id === 'lista-modal') {
                fecharModal('lista-modal');
            } else if (event.target.classList.contains('modal')) {
                fecharModal(event.target.id);
            }
        };
        window.addEventListener("scroll", () => {
            const nearBottom = window.innerHeight + window.scrollY >= document.documentElement.scrollHeight - 200;
            if (nearBottom && !carregando && offset < cursosFiltrados.length) {
                renderizarMaisCursos();
            }
        });
        window.addEventListener('keydown', (event) => {
          if (event.key === 'Escape') {
            // 1. Procura por qualquer modal que esteja vis√≠vel
            const modalAberto = document.querySelector('.modal[style*="display: block"]');
            
            // 2. Se encontrou um, fecha-o diretamente
            if (modalAberto) {
              // Impede que o 'Esc' execute outras a√ß√µes padr√£o do navegador (como desfocar o bot√£o)
              event.preventDefault(); 
              
              // Chama a fun√ß√£o de fechar, que j√° sabe como lidar com qualquer modal
              fecharModal(modalAberto.id);
            }
          }
        });
    });

    function resetarFiltros() {
      document.getElementById('busca').value = '';
      document.getElementById('instituicao').value = '';
      document.getElementById('tipo').value = '';
      document.getElementById('campus').value = '';
      document.getElementById('duracao').value = '';
    
      // Ap√≥s limpar os campos, chama a fun√ß√£o de filtrar para atualizar a tela
      filtrarCursos();
    }
  
    function mostrarListaSorteados() {
        const sorteados = cursos.filter(c => c.isSorteado);
        // O √∫ltimo 'true' indica que √© a lista de sorteados, para mostrar os bot√µes certos
        abrirModalDeLista('Cursos J√° Sorteados', sorteados, false, true); 
    }
    function limparListaSorteados() {
        if (confirm('Tem certeza que deseja limpar a lista de cursos sorteados?')) {
            cursos.forEach(c => c.isSorteado = false);
            salvarListas(); // Salva o novo estado
            fecharModal('lista-modal'); // Fecha o modal da lista
            // Esconde o bot√£o da lista de sorteados, j√° que ela est√° vazia
            document.getElementById('show-sorteados-btn').style.display = 'none';
        }
    }
    function toggleFavoritoDaLista(cursoId, isSorteados) {
        toggleFavorito(cursoId);
        salvarListas(); // Garante que a mudan√ßa seja salva
    
        const cardNaLista = document.getElementById(`lista-card-${cursoId}`);
        if (!cardNaLista) return;
    
        if (!isSorteados) {
            // Se for a lista de favoritos, o item some ao ser desfavoritado
            cardNaLista.remove();
        } else {
            // Se for a lista de sorteados, apenas atualiza a cor da estrela
            const curso = cursos.find(c => c.id === cursoId);
            const buttonNaLista = cardNaLista.querySelector('.card-actions-lista button:first-child');
            if(buttonNaLista) buttonNaLista.classList.toggle('favorito-ativo', curso.isFavorito);
        }
    }
    
    function toggleEliminadoDaLista(cursoId, isSorteados, isRestaurando) {
        toggleEliminado(cursoId);
        salvarListas(); // Garante que a mudan√ßa seja salva
    
        if (isSorteados) {
            // Na lista de sorteados, o curso nunca some, apenas o bot√£o muda
            const cardNaLista = document.getElementById(`lista-card-${cursoId}`);
            if (!cardNaLista) return;
            
            // Recria apenas os bot√µes para refletir o novo estado (üö´ ou ‚ôªÔ∏è)
            const curso = cursos.find(c => c.id === cursoId);
            const botaoEliminarRestaurar = curso.isEliminado
                ? `<button title="Restaurar curso" onclick="toggleEliminadoDaLista(${curso.id}, true, true)">‚ôªÔ∏è</button>`
                : `<button title="Eliminar curso" onclick="toggleEliminadoDaLista(${curso.id}, true, false)">üö´</button>`;
            
            // Atualiza o bot√£o espec√≠fico
            cardNaLista.querySelector('.card-actions-lista button:last-child').outerHTML = botaoEliminarRestaurar;
    
        } else {
            // Em outras listas (como favoritos), o item some ao ser eliminado
            const cardNaLista = document.getElementById(`lista-card-${cursoId}`);
            if (cardNaLista) cardNaLista.remove();
        }
    }
    // Fun√ß√£o principal que l√™ as op√ß√µes, prepara os dados e gera o PDF
    function gerarPDF() {
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF();
    
      // 1. LER AS OP√á√ïES DO MODAL
      const incluirFavoritos = document.getElementById('print-favoritos').checked;
      const incluirEmDuvida = document.getElementById('print-emduvida').checked;
      const incluirEliminados = document.getElementById('print-eliminados').checked;
    
      const fonteTodos = document.getElementById('print-source-todos').checked;
      const fonteFiltrados = document.getElementById('print-source-filtrados').checked;
    
      // Valida√ß√£o: Garante que uma das fontes de dados foi selecionada
      if (!fonteTodos && !fonteFiltrados) {
        alert('Por favor, selecione se deseja ignorar os filtros ou usar apenas os cursos filtrados.');
        return; // Para a execu√ß√£o
      }
    
      // 2. SELECIONAR A LISTA DE CURSOS BASE
      // Decide se vamos usar a lista completa (cursos) ou a que j√° est√° filtrada na tela (cursosFiltrados)
      const listaBase = fonteFiltrados ? cursosFiltrados : cursos;
    
      // 3. PREPARAR OS DADOS PARA A TABELA
      const corpoTabela = []; // Array que vai conter as linhas da nossa tabela
      const cabecalho = [['Curso', 'Tipo', 'Institui√ß√£o', 'Campus', 'Hor√°rio', 'Dura√ß√£o', 'Acesso']];
    
      // Fun√ß√£o auxiliar para adicionar cursos √† tabela
      const adicionarCursosNaTabela = (lista, categoria) => {
        // Adiciona uma linha de t√≠tulo para a categoria
        if (lista.length > 0) {
          corpoTabela.push([{ content: `--- ${categoria} ---`, colSpan: 7, styles: { fontStyle: 'bold', fillColor: '#d3d3d3' } }]);
        }
        // Adiciona as linhas de dados de cada curso
        lista.forEach(curso => {
          corpoTabela.push([
            curso.Curso,
            curso.Tipo,
            curso.Institui√ß√£o || 'UFES',
            curso.Campus,
            curso.Hor√°rio,
            `${curso.Semestres} semestres`,
            curso['Forma de acesso']
          ]);
        });
      };
    
      // Filtra e adiciona cada categoria de curso, se selecionada
      if (incluirFavoritos) {
        const favoritos = listaBase.filter(c => c.isFavorito);
        adicionarCursosNaTabela(favoritos, 'Cursos Favoritos');
      }
      if (incluirEmDuvida) {
        const emDuvida = listaBase.filter(c => !c.isFavorito && !c.isEliminado);
        adicionarCursosNaTabela(emDuvida, 'Em D√∫vida');
      }
      if (incluirEliminados) {
        const eliminados = listaBase.filter(c => c.isEliminado);
        adicionarCursosNaTabela(eliminados, 'Cursos Eliminados');
      }
    
      // Valida√ß√£o: Se nenhuma lista tiver cursos, avisa o usu√°rio
      if (corpoTabela.length === 0) {
        alert('Nenhum curso para imprimir com as op√ß√µes selecionadas.');
        return;
      }
    
      // 4. GERAR O PDF
      doc.autoTable({
        head: cabecalho,
        body: corpoTabela,
        startY: 20, // Posi√ß√£o inicial da tabela na p√°gina
        didDrawPage: function(data) {
          // Adiciona um t√≠tulo ao documento
          doc.setFontSize(16);
          doc.text("Rela√ß√£o de Cursos Selecionados", data.settings.margin.left, 15);
        },
        // Estilo para as linhas alternadas (zebra)
        styles: {
          fontSize: 8,
          cellPadding: 2,
        },
        alternateRowStyles: {
          fillColor: [245, 245, 245] // Cinza claro
        }
      });
    
      // Fecha o modal e salva o arquivo
      fecharModal('print-modal');
      doc.save('minha-lista-de-cursos.pdf');
    }
  
</script>
</body>
</html>
