<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Catálogo de Cursos Superiores em Instituições Públicas no ES</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.23/jspdf.plugin.autotable.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.2/dist/confetti.browser.min.js"></script>
  
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background-color: #f4f9ff;
      color: #333;
      margin: 0;
      padding: 0;
    }

    header {
      background-color: #003366;
      color: white;
      padding: 1rem;
      text-align: center;
    }

    main {
      padding: 2rem;
    }

    .filtros {
      display: flex;
      flex-wrap: wrap;
      gap: 1rem;
      margin-bottom: 2rem;
    }

    .filtros input,
    .filtros select {
      padding: 0.5rem;
      font-size: 1rem;
      border-radius: 4px;
      border: 1px solid #ccc;
    }

    .card-container {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
      gap: 1.5rem;
      min-height: 50vh;
    }

    .card {
      background-color: white;
      border-radius: 8px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
      overflow: hidden;
      display: flex;
      flex-direction: column; /* Organiza o conteúdo do card em coluna */
      transition: transform 0.2s ease, opacity 0.3s ease; /* Transição mais simples */
      opacity: 1;
    }

    .card:hover {
      transform: scale(1.03);
    }

    .card img {
      width: 100%;
      height: 140px;
      object-fit: cover;
    }

    .card-content {
      padding: 1rem;
      flex-grow: 1; /* <-- ESTA É A PROPRIEDADE MÁGICA QUE IGUALA AS ALTURAS */
    }

    .card-content h2 {
      font-size: 1.1rem;
      margin: 0 0 0.5rem;
    }

    .card-content p {
      font-size: 0.95rem;
      margin: 0;
    }
    
    .modal {
      display: none;
      position: fixed;
      z-index: 1000;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      overflow-y: auto;
      background-color: rgba(0,0,0,0.8);
    }

    .modal-content {
      background-color: #fff;
      margin: 5% auto;
      padding: 2rem;
      max-width: 600px;
      border-radius: 10px;
      position: relative;
    }

    .close {
      color: #aaa;
      position: absolute;
      top: 10px;
      right: 20px;
      font-size: 1.5rem;
      cursor: pointer;
    }

    iframe {
      width: 100%;
      height: 315px;
      border: none;
      margin-top: 1rem;
    }

    @media (max-width: 600px) {
      iframe {
        height: 200px;
      }
    }
     @media (max-width: 600px) { /* Esta é a media query para telas menores que 600px */
      iframe {
        height: 200px;
      }

      .card-container {
        grid-template-columns: repeat(2, 1fr); /* 2 colunas */
        gap: 1rem; /* Espaçamento entre os cards */
      }

      /* Ajustes opcionais para o conteúdo dos cards em telas menores */
      .card-content h2 {
        font-size: 1rem; /* Fonte menor para o título */
      }
      .card-content p {
        font-size: 0.85rem; /* Fonte menor para os parágrafos */
      }
    }
    
    /* Ajustes para o Wrapper do Ícone e Logo */
    .card-icon-wrapper {
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 1rem;
      gap: 1.5rem;
      min-height: 80px;
    }
    
    .card-icon {
      font-size: 64px;
      color: #003366;
      flex-shrink: 0; /* O ÍCONE não deve encolher */
    }
    
    .institution-logo {
      /* 1. Define um LIMITE MÁXIMO, não um tamanho fixo */
      max-width: 60px;
      max-height: 60px;
    
      /* 2. Garante que a imagem ocupe o espaço disponível sem distorcer */
      width: 100%;
      height: auto;
      
      /* 3. Garante que a imagem caiba INTEIRA dentro do espaço, sem cortar */
      object-fit: contain; 
      
      /* 4. Impede a imagem de ser "esmagada" pelo ícone ao lado */
      flex-shrink: 0;
    }

      /* --- ESTILOS PARA O MODO ELIMINE E FAVORITE --- */
      
      /* Esconde as ações do card por padrão */
      .card-actions {
        display: none;
        justify-content: space-around;
        padding: 0.5rem 0;
        border-top: 1px solid #eee; /* Uma linha para separar */
        margin-top: 0.5rem;
      }
      /* MOSTRA as ações quando o modo está ativo */
      body.modo-edicao-ativo .card-actions {
        display: flex;
      }
      /* Estilo dos botões de ação (estrela e proibido) */
      .card-actions button {
        background: none;
        border: none;
        cursor: pointer;
        font-size: 32px; /* Tamanho grande para toque */
        color: #ccc; /* Começam cinza, sem cor */
        transition: transform 0.2s ease, color 0.2s ease;
        padding: 0 1rem; /* Adiciona espaço para facilitar o clique */
      }
      /* Efeito ao passar o mouse ou tocar */
      .card-actions button:hover {
        transform: scale(1.2);
      }
      /* Estilo para a estrela favoritada */
      .card-actions button.favorito-ativo .material-symbols-outlined {
        color: #ffc107; /* Amarelo ouro */
        font-variation-settings: 'FILL' 1; /* Transforma o contorno em preenchido */
      }
      
      /* --- ESTILOS DOS CONTROLES NO MENU DE FILTROS --- */
      
      /* Estilo para o botão principal de ligar/desligar o modo */
      #toggle-edit-mode {
        display: flex;
        align-items: center;
        gap: 8px;
        padding: 10px 15px;
        background-color: #6c757d;
        color: white;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        font-size: 1rem;
      }
      #toggle-edit-mode.active {
        background-color: #0056b3;
      }

      #reset-filtros-btn,
      #curso-surpresa-btn {
        background-color: #6c757d; /* Cinza, como o botão de Edição */
        color: white;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        padding: 8px; /* Um pouco menor para ser mais discreto */
        display: flex;
        align-items: center;
        justify-content: center;
      }
      /* Container para os botões de Favoritos, Lixeira, etc. */
      .edit-actions-container {
        display: none; /* Escondido por padrão */
        gap: 10px;
        margin-left: auto; /* Empurra para a direita */
      }
      /* Mostra o container quando o modo de edição está ativo */
      body.modo-edicao-ativo .edit-actions-container {
        display: flex;
      }
      .edit-actions-container button {
        display: flex;
        align-items: center;
        gap: 8px;
        padding: 10px 15px;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        font-size: 1rem;
        background-color: #f0f0f0;
      }
      .edit-actions-container button.danger {
        background-color: #dc3545; /* Vermelho perigo */
        color: white;
      }

      .container-lista {
        max-height: 60vh;
        overflow-y: auto;
        margin-top: 1rem;
      }
      .card-lista {
        display: flex;
        align-items: center;
        padding: 0.5rem;
        border-bottom: 1px solid #eee;
      }
      .card-content-lista {
        flex-grow: 1;
      }
      .card-content-lista h2 {
        font-size: 1rem;
        margin: 0;
      }
      .card-content-lista p {
        font-size: 0.9rem;
        margin: 0;
      }
      .card-icon-lista {
        margin-right: 1rem;
        color: #003366;
      }
      .card-actions-lista button {
          background: none;
          border: none;
          cursor: pointer;
          font-size: 1.5rem;
      }
      .card-clickable-area {
        cursor: pointer; /* Transforma o cursor em "mãozinha" ao passar por cima */
        flex-grow: 1;
        display: flex;
        flex-direction: column;
      }
      /* Define a animação de fade-out */
       @keyframes fadeOutAndShrink {
         to {
          opacity: 0;
          transform: scale(0.8); /* Encolhe para 80% do tamanho */
        }
      }
      
      .card.eliminando {
        animation: fadeOutAndShrink 0.25s forwards;
        pointer-events: none;
      }

      /* Estilo para o botão de Imprimir */
      #print-button {
        display: flex;
        align-items: center;
        gap: 8px;
        padding: 10px 15px;
        background-color: #28a745; /* Verde para destacar a ação */
        color: white;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        font-size: 1rem;
      }
      
      /* Estilos para as opções dentro do modal de impressão */
      .print-options {
        display: flex;
        flex-direction: column;
        gap: 0.75rem;
        margin-bottom: 1rem;
      }
      .print-options label {
        display: flex;
        align-items: center;
        gap: 8px;
        cursor: pointer;
      }
      .print-actions {
        margin-top: 2rem;
        display: flex;
        justify-content: flex-end; /* Alinha os botões à direita */
        gap: 1rem;
      }
      .print-actions button {
        padding: 10px 20px;
        border: none;
        border-radius: 5px;
        font-size: 1rem;
        cursor: pointer;
      }
      .print-actions .confirm-btn {
        background-color: #0056b3;
        color: white;
      }
      .print-actions .cancel-btn {
        background-color: #ccc;
      }

      /* Container para os botões de ação DENTRO do modal */
      .modal-actions {
        margin-top: 1.5rem;
        padding-top: 1rem;
        border-top: 1px solid #eee;
        display: flex;
        justify-content: space-around;
        gap: 1rem;
      }
      .modal-actions button {
        background-color: #f0f0f0;
        border: 1px solid #ccc;
        border-radius: 5px;
        padding: 10px 15px;
        cursor: pointer;
        font-size: 1rem;
        display: flex;
        align-items: center;
        gap: 8px;
        transition: background-color 0.2s ease;
      }
      .modal-actions button:hover {
        background-color: #e0e0e0;
      }
      @keyframes pulse {
        0% { transform: scale(1); }
        50% { transform: scale(1.1); }
        100% { transform: scale(1); }
      }
      /* Regra de Ouro para a Estrela Amarela */
      .favorito-ativo,
      .favorito-ativo .material-symbols-outlined {
        color: #ffc107 !important; /* Amarelo-ouro */
      }
      /* Ajuste no conteúdo do modal para servir de âncora para a logo */
      .modal-content {
        position: relative; /* Essencial para o posicionamento da logo */
      }
      
      /* Container para o título e o ícone do curso */
      .modal-title-container {
        display: flex;
        align-items: center;
        gap: 0.5em; /* Espaço entre o ícone e o título */
        margin-right: 70px; /* Garante espaço para a logo não sobrepor o título */
      }
      
      /* Estilo do ícone do curso no título do modal */
      .modal-title-icon {
        font-size: 1.6em;
        color: #003366;    /* Mantém a cor azul do card */
      }
      
      /* Estilo e posicionamento da logo da instituição no modal */
      .modal-institution-logo {
        max-width: 60px;  /* Mesmo tamanho máximo do card */
        max-height: 60px;
        object-fit: contain;
      }
    .modal-info-container {
      display: flex;
      flex-wrap: wrap; /* Permite que os itens quebrem a linha em telas menores */
      justify-content: space-between; /* Empurra a logo para a direita */
      align-items: center; /* Alinha verticalmente os itens */
    }
    .modal-info-container p {
      flex-basis: 70%; /* Os parágrafos ocupam 70% da largura, deixando 30% para a logo */
    }
  </style>
</head>
<body>
  <header>
    <h1 id="site-title">Catálogo de Cursos Superiores em Instituições Públicas no ES</h1>
  </header>

  <main>
    <section class="filtros" aria-label="Filtros de busca">
        <input type="text" id="busca" placeholder="Nome do curso" aria-label="Busca por nome do curso">
        <select id="instituicao" aria-label="Instituição">
          <option value="">Todas as instituições</option>
        </select>
        <select id="tipo" aria-label="Tipo de curso">
          <option value="">Todos os tipos</option>
        </select>
        <select id="campus" aria-label="Campus">
          <option value="">Todos os campi</option>
        </select>
        <select id="duracao" aria-label="Duração">
          <option value="">Todas as durações</option>
        </select>
        <button id="reset-filtros-btn" title="Limpar filtros">
          <span class="material-symbols-outlined">restart_alt</span>
        </button>
        <button id="curso-surpresa-btn" title="Curso surpresa! (filtros se aplicam)">
          <span class="material-symbols-outlined">casino</span>
        </button>
        <button id="toggle-edit-mode">
          <span class="material-symbols-outlined">tune</span>
          Elimine e Favorite
        </button>
    
        <button id="print-button">
          <span class="material-symbols-outlined">print</span>
          Imprimir Relação
        </button>
    
        <div id="edit-actions" class="edit-actions-container">
          <button id="show-favorites">⭐ Favoritos</button>
          <button id="show-eliminated">🗑️ Lixeira</button>
          <button id="show-sorteados-btn" style="display: none;">🎲 Sorteados</button> 
          <button id="clear-lists" class="danger">Limpar Tudo</button>
        </div>
    </section>

    <p id="contador-cursos" style="font-weight:bold; margin-bottom:1rem;">Exibindo 0 cursos com os filtros selecionados</p>
    
    <section id="cards" class="card-container" aria-label="Lista de cursos"></section>
    <div id="loading" class="loading-indicator">Carregando mais cursos...</div>
    <div id="loader" style="text-align:center; display:none; margin:2rem 0; font-style:italic; color:#555;">
      Carregando mais cursos...
    </div>

  </main>

  <div id="modals"></div>

  <div id="print-modal" class="modal">
    <div class="modal-content">
      <span class="close" onclick="fecharModal('print-modal')">&times;</span>
      <h2>Opções de Impressão</h2>
      <p>Você gostaria de imprimir:</p>
      <div class="print-options">
        <label><input type="checkbox" id="print-favoritos" checked> Favoritos</label>
        <label><input type="checkbox" id="print-emduvida" checked> Em dúvida</label>
        <label><input type="checkbox" id="print-eliminados"> Eliminados</label>
      </div>
  
      <p style="margin-top: 1.5rem;">Considerar os cursos na tela:</p>
      <div class="print-options">
        <label><input type="radio" name="print-source" id="print-source-todos" value="todos" required> Ignorar filtros ativos</label>
        <label><input type="radio" name="print-source" id="print-source-filtrados" value="filtrados" required> Usar apenas cursos filtrados</label>
      </div>
  
      <div class="print-actions">
        <button class="cancel-btn" onclick="fecharModal('print-modal')">Cancelar</button>
        <button class="confirm-btn" id="generate-pdf-btn">Gerar PDF</button>
      </div>
    </div>
  </div>
  
<script>
    // Variáveis globais para controlar o estado da página
    let cursos = [];
    let cursosFiltrados = [];
    let offset = 0;
    const BATCH_SIZE = 20;
    const limit = 20;
    let carregando = false;
    let modoEdicaoAtivo = false;

    // --- FUNÇÕES DE RENDERIZAÇÃO E UI (Todas juntas e organizadas) ---

    function criarCard(curso) {
        const nomeIcone = getIconeParaCurso(curso.Curso);
        const logoUrl = getLogoParaInstituicao(curso.Instituição);
        const classeFavorito = curso.isFavorito ? 'favorito-ativo' : '';
        const iconeEstrela = curso.isFavorito ? 'star' : 'star_border';
        
        return `
        <article class="card" id="card-${curso.id}">
        <div class="card-clickable-area" onclick="abrirModalDeCurso(${curso.id})">
            
            <div class="card-icon-wrapper">
              <span class="material-symbols-outlined card-icon">${nomeIcone}</span>
              ${logoUrl ? `<img src="${logoUrl}" alt="Logo ${curso.Instituição}" class="institution-logo">` : ''}
            </div>
    
            <div class="card-content">
              <h2>${curso.Curso}</h2>
              <p><strong>Instituição:</strong> ${curso.Instituição || 'N/A'}</p>
              <p><strong>Campus:</strong> ${curso.Campus}</p>
              <p><strong>Tipo:</strong> ${curso.Tipo}</p>
              <p><strong>Duração:</strong> ${curso.Semestres} semestres</p>
            </div>
          </div>
          <div class="card-actions">
            <button title="Favoritar curso" class="${classeFavorito}" onclick="toggleFavorito(${curso.id})">
              <span class="material-symbols-outlined">${iconeEstrela}</span>
            </button>
            <button title="Eliminar curso" onclick="toggleEliminado(${curso.id})">🚫</button>
          </div>
        </article>`;
    }

    function criarModal(curso, contexto = 'normal') {
        const nomeIcone = getIconeParaCurso(curso.Curso);
        const arquivoLogo = getLogoParaCurso(curso.Instituição);
    
        let actionsHTML = '';
        if (contexto === 'edicao') {
            const classeFavorito = curso.isFavorito ? 'favorito-ativo' : '';
            const iconeEstrela = curso.isFavorito ? 'star' : 'star_border';
            actionsHTML = `
            <div class="modal-actions">
                <button class="${classeFavorito}" onclick="toggleFavorito(${curso.id})"><span class="material-symbols-outlined">${iconeEstrela}</span> Favoritar</button>
                <button onclick="toggleEliminado(${curso.id}); fecharModal('modal-${curso.id}')">🚫 Eliminar</button>
            </div>`;
        } else if (contexto === 'sorteio') {
            const classeFavorito = curso.isFavorito ? 'favorito-ativo' : '';
            const iconeEstrela = curso.isFavorito ? 'star' : 'star_border';
            actionsHTML = `
            <div class="modal-actions">
                <button class="${classeFavorito}" onclick="acaoFavoritarSorteado(${curso.id})"><span class="material-symbols-outlined">${iconeEstrela}</span> Favoritar</button>
                <button onclick="sortearCursoSurpresa(true)">🎲 Sortear Novo</button>
                <button onclick="acaoEliminarSorteado(${curso.id})">🚫 Eliminar e Sortear</button>
            </div>`;
        }
    
        const formaDeAcessoComLink = transformarLinks(curso["Forma de acesso"]);
    
        return `
        <div id="modal-${curso.id}" class="modal">
          <div class="modal-content">
            <span class="close" onclick="fecharModal('modal-${curso.id}')">&times;</span>
            
            ${curso.VideoID ? `<iframe data-src="https://www.youtube.com/embed/${curso.VideoID}" title="YouTube video player" allowfullscreen></iframe>` : ''}
            
            <div class="modal-title-container">
              <span class="material-symbols-outlined modal-title-icon">${nomeIcone}</span>
              <h2>${curso.Curso}</h2>
            </div>
    
            <div class="modal-info-container"> <div> <p><strong>Tipo:</strong> ${curso.Tipo}</p>
                    <p><strong>Instituição:</strong> ${curso.Instituição || "UFES"}</p>
                </div>
                ${arquivoLogo ? `<img src="${arquivoLogo}" alt="Logo de ${curso.Instituição || 'UFES'}" class="modal-institution-logo">` : ''}
            </div>
            
            <p><strong>Campus:</strong> ${curso.Campus}</p>
            <p><strong>Horário:</strong> ${curso.Horário}</p>
            <p><strong>Acesso:</strong> ${formaDeAcessoComLink}</p>
            <a href="${curso["Página do curso"]}" target="_blank">Visitar a página do curso</a>
            ${actionsHTML} 
          </div>
        </div>`;
    }

    function abrirModalDeCurso(cursoId) {
        const contexto = modoEdicaoAtivo ? 'edicao' : 'normal';
        const curso = cursos.find(c => c.id === cursoId);
        if (!curso) return;
    
        const modalId = `modal-${curso.id}`;
        let modal = document.getElementById(modalId);
    
        if (!modal) {
            // Cria o modal com o contexto correto
            const modalHTML = criarModal(curso, contexto);
            document.getElementById('modals').insertAdjacentHTML('beforeend', modalHTML);
        } else {
            // Se o modal já existe, mas o contexto pode ter mudado, o melhor é recriá-lo
            modal.remove();
            const modalHTML = criarModal(curso, contexto);
            document.getElementById('modals').insertAdjacentHTML('beforeend', modalHTML);
        }
        
        abrirModal(modalId); // Chama a função que apenas exibe o modal
    }
    
    function abrirModal(modalId) {
        const modal = document.getElementById(modalId);
        if (!modal) return;
        const iframe = modal.querySelector('iframe');
        if (iframe && !iframe.src) {
            iframe.src = iframe.getAttribute('data-src');
        }
        modal.style.display = "block";
    }

    function fecharModal(modalId) {
        const modal = document.getElementById(modalId);
        if (!modal) return;
        if (modalId === 'lista-modal') {
            modal.remove();
        } else {
            const iframe = modal.querySelector('iframe');
            if (iframe) {
                iframe.src = "";
            }
            modal.style.display = "none";
        }
    }

    function atualizarContagem() {
        const contador = document.getElementById('contador-cursos');
        const exibidos = document.getElementById('cards').childElementCount;
        contador.textContent = `Exibindo ${exibidos} de ${cursosFiltrados.length} cursos com os filtros selecionados`;
    }

    // --- FUNÇÕES DE LÓGICA E DADOS ---
    function salvarListas() {
        const favoritosIds = cursos.filter(c => c.isFavorito).map(c => c.id);
        const eliminadosIds = cursos.filter(c => c.isEliminado).map(c => c.id);
        const sorteadosIds = cursos.filter(c => c.isSorteado).map(c => c.id);
    
        localStorage.setItem('cursosFavoritos', JSON.stringify(favoritosIds));
        localStorage.setItem('cursosEliminados', JSON.stringify(eliminadosIds));
        localStorage.setItem('cursosSorteados', JSON.stringify(sorteadosIds));
    }
  
    function renderizarMaisCursos(recriarModaisVisiveis = false) {
        const container = document.getElementById('cards');
        const modalsContainer = document.getElementById('modals');
        const fimDaLista = offset + BATCH_SIZE;
        const cursosParaRenderizar = cursosFiltrados.slice(offset, fimDaLista);
    
        if (recriarModaisVisiveis) {
            // Apaga e recria APENAS os modais dos cards que já estão na tela
            modalsContainer.innerHTML = '';
            const cursosJaRenderizados = cursosFiltrados.slice(0, offset);
            cursosJaRenderizados.forEach(curso => {
                modalsContainer.insertAdjacentHTML('beforeend', criarModal(curso, modoEdicaoAtivo ? 'edicao' : 'normal'));
            });
        }
    
        cursosParaRenderizar.forEach(curso => {
            container.insertAdjacentHTML('beforeend', criarCard(curso));
            modalsContainer.insertAdjacentHTML('beforeend', criarModal(curso, modoEdicaoAtivo ? 'edicao' : 'normal'));
        });
    
        offset = fimDaLista;
        document.getElementById('loading').style.display = 'none';
        atualizarContagem();
        verificarECarregarMaisSeNecessario();
    }
    function sortearCursoSurpresa(isResorteio = false) {
        if (cursosFiltrados.length === 0) {
            alert('Nenhum curso corresponde aos filtros selecionados para o sorteio.');
            return;
        }
    
        // Se for um re-sorteio, fecha o modal anterior primeiro
        if (isResorteio) {
            const modalAberto = document.querySelector('.modal[id^="modal-"][style*="display: block"]');
            if (modalAberto) {
                fecharModal(modalAberto.id);
            }
        }
    
        const indiceAleatorio = Math.floor(Math.random() * cursosFiltrados.length);
        const cursoSorteado = cursosFiltrados[indiceAleatorio];
        const modalId = `modal-${cursoSorteado.id}`;
    
        // Marca como sorteado e salva
        cursoSorteado.isSorteado = true;
        salvarListas();
        document.getElementById('show-sorteados-btn').style.display = 'flex'; // Garante que o botão da lista apareça
    
        // --- LÓGICA DA ANIMAÇÃO ---
        // 1. Cria e mostra o modal de suspense
        const suspenseModalHTML = `
        <div id="suspense-modal" class="modal" style="display: block; background-color: rgba(0,0,0,0.9);">
            <div class="modal-content" style="background: none; text-align: center; box-shadow: none;">
                <span style="font-size: 150px; color: #666; animation: pulse 1.5s infinite;">?</span>
            </div>
        </div>`;
        document.body.insertAdjacentHTML('beforeend', suspenseModalHTML);
    
        // 2. Espera 800ms para criar o suspense
        setTimeout(() => {
            // Remove o modal de suspense
            document.getElementById('suspense-modal').remove();
    
            // Cria o modal do curso no contexto de sorteio
            let modal = document.getElementById(modalId);
            if (modal) modal.remove(); // Remove o antigo para garantir que os botões estão certos
            const modalHTML = criarModal(cursoSorteado, 'sorteio');
            document.getElementById('modals').insertAdjacentHTML('beforeend', modalHTML);
            
            // Abre o modal do curso
            abrirModal(modalId);
            
            // 3. Solta os confetes!
            confetti({
                particleCount: 150,
                spread: 90,
                origin: { y: 0.6 },
                zIndex: 9999
            });
        }, 800); // 800ms de suspense
    }
    function transformarLinks(texto) {
      if (!texto) return '';
    
      const urlRegex = /(https?:\/\/[^\s]+)/g;
      return texto.replace(urlRegex, (url) => `<a href="${url}" target="_blank">${url}</a>`);
    }
  
    function verificarECarregarMaisSeNecessario() {
      // Usamos um pequeno delay para garantir que o navegador já recalculou o layout
      setTimeout(() => {
        const temBarraDeRolagem = document.documentElement.scrollHeight > window.innerHeight;
        if (!temBarraDeRolagem && offset < cursosFiltrados.length && !carregando) {
          renderizarMaisCursos();
        }
      }, 400); // Um delay um pouco maior após a animação de remoção
    }

    /**
     * Popula um elemento <select> com opções únicas baseadas nos dados dos cursos.
     * @param {string} filtroId - O ID do elemento <select> no HTML (ex: 'instituicao').
     * @param {string} chave - O nome da propriedade no objeto do curso (ex: 'Instituição').
     */
    function popularFiltro(filtroId, chave) {
      const selectElement = document.getElementById(filtroId);
      
      // 1. Pega todos os valores para a chave especificada.
      const valores = cursos.map(c => c[chave]);
      
      // 2. Filtra para ter apenas valores únicos e remove quaisquer valores vazios/nulos.
      const valoresUnicos = [...new Set(valores)].filter(valor => valor);
      
      // 3. Ordena os valores (numericamente se forem números, alfabeticamente caso contrário).
      valoresUnicos.sort((a, b) => {
        if (typeof a === 'number' && typeof b === 'number') {
          return a - b; // Ordenação numérica
        }
        return String(a).localeCompare(String(b)); // Ordenação alfabética
      });
      
      // 4. Cria e adiciona um <option> para cada valor único.
      valoresUnicos.forEach(valor => {
        const opt = document.createElement('option');
        opt.value = valor;
        // Adiciona "semestres" ao texto se for o filtro de duração
        opt.textContent = (filtroId === 'duracao') ? `${valor} semestres` : valor;
        selectElement.appendChild(opt);
      });
    }

    function normalizarTexto(texto) {
      if (!texto) return '';
      return texto.toString().toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g, "");
    }
  
    function filtrarCursos() {
        const texto = normalizarTexto(document.getElementById('busca').value);
        const inst = document.getElementById('instituicao').value;
        const tipo = document.getElementById('tipo').value;
        const campus = document.getElementById('campus').value;
        const duracao = document.getElementById('duracao').value;
        cursosFiltrados = cursos.filter(curso => {
            if (modoEdicaoAtivo && curso.isEliminado) {
                return false;
            }
            const instituicaoCurso = curso.Instituição || "UFES";
         return (
              normalizarTexto(curso.Curso).includes(texto) &&
              (inst === "" || instituicaoCurso === inst) &&
              (tipo === "" || curso.Tipo === tipo) &&
              (campus === "" || curso.Campus === campus) &&
              (duracao === "" || curso.Semestres.toString() === duracao)
          );
        });
        offset = 0;
        document.getElementById('cards').innerHTML = "";
        document.getElementById('modals').innerHTML = "";
        renderizarMaisCursos();
    }

    function getLogoParaInstituicao(nomeInstituicao) {
        if (!nomeInstituicao) {
            return '';
        }
    
        const nome = nomeInstituicao.toUpperCase();
        // Agora usando seus arquivos locais na pasta /img
        if (nome === 'UFES') {
            return './img/logo_ufes_pequena.png';
        }
        if (nome === 'IFES') {
            return './img/logo_ifes_pequena.png';
        }
        if (nome === 'FAMES') {
            return './img/logo_fames_pequena.png';
        }
        return ''; // Retorna vazio para qualquer outra instituição
    }
  
    function getIconeParaCurso(nomeDoCurso) {
        const nome = nomeDoCurso.toUpperCase();
        // Regras mais específicas vêm primeiro
        if (nome.includes('EDUCAÇÃO FÍSICA')) return 'sports_gymnastics'; // Ícone para Ed. Física
        if (nome.includes('FÍSICA')) return 'radio_button_checked'; // Ícone para Física (quântica, etc.)
        if (nome.includes('ENGENHARIA')) return 'engineering';
        if (nome.includes('COMPUTAÇÃO') || nome.includes('SISTEMAS')) return 'computer';
        if (nome.includes('DIREITO')) return 'gavel';
        if (nome.includes('MEDICINA')) return 'local_hospital';
        if (nome.includes('ARQUITETURA')) return 'architecture';
        if (nome.includes('QUÍMICA')) return 'science';
        if (nome.includes('BIOLÓGICAS') || nome.includes('BIOLOGIA')) return 'biotech';
        if (nome.includes('MATEMÁTICA')) return 'functions';
        if (nome.includes('LETRAS')) return 'translate';
        if (nome.includes('PEDAGOGIA') || nome.includes('EDUCAÇÃO')) return 'school';
        if (nome.includes('HISTÓRIA')) return 'history_edu';
        if (nome.includes('GEOGRAFIA')) return 'public';
        if (nome.includes('FILOSOFIA')) return 'psychology';
        if (nome.includes('ARTES')) return 'palette';
        if (nome.includes('MÚSICA')) return 'music_note';
        if (nome.includes('ADMINISTRAÇÃO') || nome.includes('CIÊNCIAS CONTÁBEIS')) return 'account_balance';
        if (nome.includes('ECONÔMICAS') || nome.includes('ECONOMIA')) return 'trending_up';
        if (nome.includes('JORNALISMO') || nome.includes('COMUNICAÇÃO')) return 'newspaper';
        if (nome.includes('FARMÁCIA')) return 'medication';
        if (nome.includes('NUTRIÇÃO')) return 'nutrition';
        if (nome.includes('PSICOLOGIA')) return 'neurology';
        if (nome.includes('AGRONOMIA')) return 'eco';
        return 'book_4';
    }
    function getLogoParaCurso(instituicao) {
        const inst = instituicao || "UFES"; // Garante que UFES seja o padrão
        switch (inst.toUpperCase()) {
            case 'UFES':
                return 'img/logo_ufes_pequena.png';
            case 'IFES':
                return 'img/logo_ifes_pequena.png';
            case 'FAMES':
                return 'img/logo_fames_pequena.png';
            default:
                return ''; // Retorna vazio se não encontrar
        }
    }
    // --- FUNÇÕES PARA O MODO "ELIMINE E FAVORITE" ---

    function toggleFavorito(cursoId) {
        const curso = cursos.find(c => c.id === cursoId);
        if (!curso) return;
    
        const estavaEliminado = curso.isEliminado; // Guarda o estado anterior
    
        // Lógica principal
        curso.isFavorito = !curso.isFavorito;
        if (curso.isFavorito && curso.isEliminado) {
            curso.isEliminado = false;
        }
        salvarListas();
    
        // Atualização visual centralizada (card e modal)
        const cardButton = document.querySelector(`#card-${cursoId} .card-actions button:first-child`);
        if (cardButton) {
            cardButton.classList.toggle('favorito-ativo', curso.isFavorito);
            cardButton.querySelector('.material-symbols-outlined').textContent = curso.isFavorito ? 'star' : 'star_border';
        }
        const modalButton = document.querySelector(`#modal-${cursoId} .modal-actions button:first-child`);
        if (modalButton) {
            modalButton.classList.toggle('favorito-ativo', curso.isFavorito);
            modalButton.querySelector('.material-symbols-outlined').textContent = curso.isFavorito ? 'star' : 'star_border';
        }
        
        // Se um curso foi restaurado da lixeira ao ser favoritado,
        // E NENHUM MODAL DE CURSO ESTIVER ABERTO, atualize a tela.
        const isModalDeCursoAberto = document.querySelector('.modal[id^="modal-"][style*="display: block"]');
        if (estavaEliminado && !isModalDeCursoAberto) {
            filtrarCursos();
        }
    }
    
    function toggleEliminado(cursoId) {
        const curso = cursos.find(c => c.id === cursoId);
        if (!curso) return;
    
        // Ação: Mudar o status de eliminado
        curso.isEliminado = !curso.isEliminado;
    
        // NOVA REGRA: Se o curso foi eliminado, ele NÃO PODE ser favorito.
        if (curso.isEliminado && curso.isFavorito) {
            curso.isFavorito = false;
            // E atualiza a estrelinha do card para refletir isso
            const cardButton = document.querySelector(`#card-${cursoId} .card-actions button:first-child`);
            if (cardButton) {
                cardButton.classList.remove('favorito-ativo');
                cardButton.querySelector('.material-symbols-outlined').textContent = 'star_border';
            }
        }
        
        salvarListas(); // Salva ambos os estados
    
        // O resto da lógica de animação e remoção continua igual...
        const cardElement = document.getElementById(`card-${cursoId}`);
        if (curso.isEliminado && cardElement) {
            cardElement.classList.add('eliminando');
            cardElement.addEventListener('animationend', () => {
                cardElement.remove();
                atualizarContagem();
                verificarECarregarMaisSeNecessario();
            }, { once: true });
        } else if (!curso.isEliminado) {
            filtrarCursos();
        }
    }

    function abrirModalDeLista(titulo, listaDeCursos, isLixeira = false, isSorteados = false) {
        const modalAntigo = document.getElementById('lista-modal');
        if (modalAntigo) modalAntigo.remove();
    
        let cardsHTML = '';
        if (listaDeCursos.length === 0) {
            cardsHTML = '<p>Nenhum curso aqui. A lista está vazia.</p>';
        } else {
            listaDeCursos.forEach(curso => {
                const nomeIcone = getIconeParaCurso(curso.Curso);
                let acaoBotao = '';
    
                if (isLixeira) {
                    acaoBotao = `<button title="Restaurar curso" onclick="restaurarCursoDaLixeira(${curso.id})">♻️</button>`;
                } else { // Para Favoritos e Sorteados
                    const classeFavorito = curso.isFavorito ? 'favorito-ativo' : '';
                    const iconeEstrela = curso.isFavorito ? 'star' : 'star_border'; 
                    const botaoEliminarRestaurar = curso.isEliminado
                        ? `<button title="Restaurar curso" onclick="toggleEliminadoDaLista(${curso.id}, ${isSorteados}, true)">♻️</button>`
                        : `<button title="Eliminar curso" onclick="toggleEliminadoDaLista(${curso.id}, ${isSorteados}, false)">🚫</button>`;
                    acaoBotao = `
                        <button title="Favoritar curso" class="${classeFavorito}" onclick="toggleFavoritoDaLista(${curso.id}, ${isSorteados})">
                            <span class="material-symbols-outlined">${iconeEstrela}</span>
                        </button>
                        ${botaoEliminarRestaurar}
                    `;
                }
                cardsHTML += `
                <article class="card-lista" id="lista-card-${curso.id}">
                  <span class="material-symbols-outlined card-icon-lista">${nomeIcone}</span>
                  <div class="card-content-lista"><h2>${curso.Curso}</h2><p>${curso.Campus}</p></div>
                  <div class="card-actions-lista">${acaoBotao}</div>
                </article>`;
            });
        }
    
        const botaoLimpar = isSorteados ? '<button onclick="limparListaSorteados()" class="danger" style="margin-top: 1rem; width: 100%;">Limpar Histórico de Sorteios</button>' : '';
    
        const modalHTML = `
        <div id="lista-modal" class="modal" style="display:block;">
          <div class="modal-content">
            <span class="close" onclick="fecharModal('lista-modal')">&times;</span>
            <h2>${titulo}</h2>
            <div class="container-lista">${cardsHTML}</div>
            ${botaoLimpar}
          </div>
        </div>`;
        document.body.insertAdjacentHTML('beforeend', modalHTML);
    }

    function removerFavoritoDaLista(cursoId) {
        toggleFavorito(cursoId);
        const cardNaLista = document.getElementById(`lista-card-${cursoId}`);
        if (cardNaLista) cardNaLista.remove();
    }

    function restaurarCursoDaLixeira(cursoId) {
        const curso = cursos.find(c => c.id === cursoId);
        if (!curso) return;
    
        // Apenas muda o estado e salva. Não chama mais toggleEliminado.
        curso.isEliminado = false; 
        salvarListas();
    
        // Remove o card da lista do modal da lixeira
        const cardNaLista = document.getElementById(`lista-card-${cursoId}`);
        if (cardNaLista) {
            cardNaLista.remove();
        }
        // Força a re-filtragem dos cards na tela principal para o curso reaparecer
        filtrarCursos();
    }
    function acaoFavoritarSorteado(cursoId) {
        if (!modoEdicaoAtivo) {
            modoEdicaoAtivo = true;
            document.body.classList.add('modo-edicao-ativo');
            document.getElementById('toggle-edit-mode').classList.add('active');
        }
        // A função toggleFavorito já é inteligente o suficiente para atualizar
        // tanto o card quanto o modal. Não precisamos de mais nada aqui.
        toggleFavorito(cursoId);
    }
    
    function acaoEliminarSorteado(cursoId) {
        // Ativa o modo de edição se não estiver ativo
        if (!modoEdicaoAtivo) {
            document.getElementById('toggle-edit-mode').click();
        }
        // Elimina o curso
        toggleEliminado(cursoId);
        
        // Fecha o modal atual e sorteia o próximo
        fecharModal(`modal-${cursoId}`);
        sortearCursoSurpresa(true); // O 'true' indica que é um re-sorteio
    }

    // --- INICIALIZAÇÃO DA PÁGINA ---
    document.addEventListener('DOMContentLoaded', () => {
        fetch('dados_cursos_ufes_atualizado.json')
            .then(response => response.json())
            .then(data => {
                // Carrega os IDs salvos do localStorage
                const favoritosSalvos = JSON.parse(localStorage.getItem('cursosFavoritos')) || [];
                const eliminadosSalvos = JSON.parse(localStorage.getItem('cursosEliminados')) || [];
                const sorteadosSalvos = JSON.parse(localStorage.getItem('cursosSorteados')) || [];
            
                data.sort((a, b) => a.Curso.localeCompare(b.Curso));
                
                // Adiciona os estados salvos aos cursos
                cursos = data.map((curso, index) => ({
                    ...curso,
                    id: index,
                    isFavorito: favoritosSalvos.includes(index),
                    isEliminado: eliminadosSalvos.includes(index),
                    isSorteado: sorteadosSalvos.includes(index) // <-- NOVA PROPRIEDADE
                }));
            
                // Se já houver cursos sorteados da última visita, mostra o botão da lista
                if (sorteadosSalvos.length > 0) {
                    document.getElementById('show-sorteados-btn').style.display = 'flex';
                }
    
                cursosFiltrados = [...cursos];
                
                // Popula os filtros dinamicamente com base nos dados carregados
                popularFiltro('instituicao', 'Instituição');
                popularFiltro('tipo', 'Tipo');
                popularFiltro('campus', 'Campus');
                popularFiltro('duracao', 'Semestres');

                // Adiciona os 'escutadores' de eventos para os filtros
                document.getElementById('busca').addEventListener('input', filtrarCursos);
                document.getElementById('instituicao').addEventListener('change', filtrarCursos);
                document.getElementById('tipo').addEventListener('change', filtrarCursos);
                document.getElementById('campus').addEventListener('change', filtrarCursos);
                document.getElementById('duracao').addEventListener('change', filtrarCursos);
                document.getElementById('reset-filtros-btn').addEventListener('click', resetarFiltros);
                // Adiciona o 'escutador' para o botão de curso surpresa
                document.getElementById('curso-surpresa-btn').addEventListener('click', sortearCursoSurpresa);
                // Para o botão que exibe a lista de cursos já sorteados
                document.getElementById('show-sorteados-btn').addEventListener('click', mostrarListaSorteados);
                // Adiciona os 'escutadores' de eventos para o MODO DE EDIÇÃO
                const toggleButton = document.getElementById('toggle-edit-mode');
                toggleButton.addEventListener('click', () => {
                    modoEdicaoAtivo = !modoEdicaoAtivo;
                    document.body.classList.toggle('modo-edicao-ativo');
                    toggleButton.classList.toggle('active');
                    filtrarCursos();
                });
                document.getElementById('show-favorites').addEventListener('click', () => {
                    const favoritos = cursos.filter(c => c.isFavorito);
                    abrirModalDeLista('Meus Favoritos', favoritos);
                });
                document.getElementById('show-eliminated').addEventListener('click', () => {
                    const eliminados = cursos.filter(c => c.isEliminado);
                    abrirModalDeLista('Cursos na Lixeira', eliminados, true);
                });
                document.getElementById('clear-lists').addEventListener('click', () => {
                    if (confirm('Tem certeza que deseja limpar TODAS as suas listas (Favoritos, Lixeira e Sorteados)? Esta ação não pode ser desfeita.')) {
                        cursos.forEach(c => {
                            c.isFavorito = false;
                            c.isEliminado = false;
                            c.isSorteado = false;
                        });
                        salvarListas(); // Salva o estado limpo
                        filtrarCursos();
                    }
                });
                
                // Adiciona o listener para o botão de Imprimir
                document.getElementById('print-button').addEventListener('click', () => {
                  abrirModal('print-modal');
                });
                // Adiciona o listener para o botão "Gerar PDF" dentro do modal
                document.getElementById('generate-pdf-btn').addEventListener('click', () => {
                  gerarPDF(); 
                });

                renderizarMaisCursos(); // Carrega o primeiro lote de cursos
            })
            .catch(error => console.error('Erro fatal:', error));

        // Listeners Globais
        window.onclick = function(event) {
            if (event.target.id === 'lista-modal') {
                fecharModal('lista-modal');
            } else if (event.target.classList.contains('modal')) {
                fecharModal(event.target.id);
            }
        };
        window.addEventListener("scroll", () => {
            const nearBottom = window.innerHeight + window.scrollY >= document.documentElement.scrollHeight - 200;
            if (nearBottom && !carregando && offset < cursosFiltrados.length) {
                renderizarMaisCursos();
            }
        });
        window.addEventListener('keydown', (event) => {
          if (event.key === 'Escape') {
            // 1. Procura por qualquer modal que esteja visível
            const modalAberto = document.querySelector('.modal[style*="display: block"]');
            
            // 2. Se encontrou um, fecha-o diretamente
            if (modalAberto) {
              // Impede que o 'Esc' execute outras ações padrão do navegador (como desfocar o botão)
              event.preventDefault(); 
              
              // Chama a função de fechar, que já sabe como lidar com qualquer modal
              fecharModal(modalAberto.id);
            }
          }
        });
    });

    function resetarFiltros() {
      document.getElementById('busca').value = '';
      document.getElementById('instituicao').value = '';
      document.getElementById('tipo').value = '';
      document.getElementById('campus').value = '';
      document.getElementById('duracao').value = '';
    
      // Após limpar os campos, chama a função de filtrar para atualizar a tela
      filtrarCursos();
    }
  
    function mostrarListaSorteados() {
        const sorteados = cursos.filter(c => c.isSorteado);
        // O último 'true' indica que é a lista de sorteados, para mostrar os botões certos
        abrirModalDeLista('Cursos Já Sorteados', sorteados, false, true); 
    }
    function limparListaSorteados() {
        if (confirm('Tem certeza que deseja limpar a lista de cursos sorteados?')) {
            cursos.forEach(c => c.isSorteado = false);
            salvarListas(); // Salva o novo estado
            fecharModal('lista-modal'); // Fecha o modal da lista
            // Esconde o botão da lista de sorteados, já que ela está vazia
            document.getElementById('show-sorteados-btn').style.display = 'none';
        }
    }
    function toggleFavoritoDaLista(cursoId, isSorteados) {
        toggleFavorito(cursoId);
        salvarListas(); // Garante que a mudança seja salva
    
        const cardNaLista = document.getElementById(`lista-card-${cursoId}`);
        if (!cardNaLista) return;
    
        if (!isSorteados) {
            // Se for a lista de favoritos, o item some ao ser desfavoritado
            cardNaLista.remove();
        } else {
            // Se for a lista de sorteados, apenas atualiza a cor da estrela
            const curso = cursos.find(c => c.id === cursoId);
            const buttonNaLista = cardNaLista.querySelector('.card-actions-lista button:first-child');
            if(buttonNaLista) buttonNaLista.classList.toggle('favorito-ativo', curso.isFavorito);
        }
    }
    
    function toggleEliminadoDaLista(cursoId, isSorteados, isRestaurando) {
        toggleEliminado(cursoId);
        salvarListas(); // Garante que a mudança seja salva
    
        if (isSorteados) {
            // Na lista de sorteados, o curso nunca some, apenas o botão muda
            const cardNaLista = document.getElementById(`lista-card-${cursoId}`);
            if (!cardNaLista) return;
            
            // Recria apenas os botões para refletir o novo estado (🚫 ou ♻️)
            const curso = cursos.find(c => c.id === cursoId);
            const botaoEliminarRestaurar = curso.isEliminado
                ? `<button title="Restaurar curso" onclick="toggleEliminadoDaLista(${curso.id}, true, true)">♻️</button>`
                : `<button title="Eliminar curso" onclick="toggleEliminadoDaLista(${curso.id}, true, false)">🚫</button>`;
            
            // Atualiza o botão específico
            cardNaLista.querySelector('.card-actions-lista button:last-child').outerHTML = botaoEliminarRestaurar;
    
        } else {
            // Em outras listas (como favoritos), o item some ao ser eliminado
            const cardNaLista = document.getElementById(`lista-card-${cursoId}`);
            if (cardNaLista) cardNaLista.remove();
        }
    }
    // Função principal que lê as opções, prepara os dados e gera o PDF
    function gerarPDF() {
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF();
    
      // 1. LER AS OPÇÕES DO MODAL
      const incluirFavoritos = document.getElementById('print-favoritos').checked;
      const incluirEmDuvida = document.getElementById('print-emduvida').checked;
      const incluirEliminados = document.getElementById('print-eliminados').checked;
    
      const fonteTodos = document.getElementById('print-source-todos').checked;
      const fonteFiltrados = document.getElementById('print-source-filtrados').checked;
    
      // Validação: Garante que uma das fontes de dados foi selecionada
      if (!fonteTodos && !fonteFiltrados) {
        alert('Por favor, selecione se deseja ignorar os filtros ou usar apenas os cursos filtrados.');
        return; // Para a execução
      }
    
      // 2. SELECIONAR A LISTA DE CURSOS BASE
      // Decide se vamos usar a lista completa (cursos) ou a que já está filtrada na tela (cursosFiltrados)
      const listaBase = fonteFiltrados ? cursosFiltrados : cursos;
    
      // 3. PREPARAR OS DADOS PARA A TABELA
      const corpoTabela = []; // Array que vai conter as linhas da nossa tabela
      const cabecalho = [['Curso', 'Tipo', 'Instituição', 'Campus', 'Horário', 'Duração', 'Acesso']];
    
      // Função auxiliar para adicionar cursos à tabela
      const adicionarCursosNaTabela = (lista, categoria) => {
        // Adiciona uma linha de título para a categoria
        if (lista.length > 0) {
          corpoTabela.push([{ content: `--- ${categoria} ---`, colSpan: 7, styles: { fontStyle: 'bold', fillColor: '#d3d3d3' } }]);
        }
        // Adiciona as linhas de dados de cada curso
        lista.forEach(curso => {
          corpoTabela.push([
            curso.Curso,
            curso.Tipo,
            curso.Instituição || 'UFES',
            curso.Campus,
            curso.Horário,
            `${curso.Semestres} semestres`,
            curso['Forma de acesso']
          ]);
        });
      };
    
      // Filtra e adiciona cada categoria de curso, se selecionada
      if (incluirFavoritos) {
        const favoritos = listaBase.filter(c => c.isFavorito);
        adicionarCursosNaTabela(favoritos, 'Cursos Favoritos');
      }
      if (incluirEmDuvida) {
        const emDuvida = listaBase.filter(c => !c.isFavorito && !c.isEliminado);
        adicionarCursosNaTabela(emDuvida, 'Em Dúvida');
      }
      if (incluirEliminados) {
        const eliminados = listaBase.filter(c => c.isEliminado);
        adicionarCursosNaTabela(eliminados, 'Cursos Eliminados');
      }
    
      // Validação: Se nenhuma lista tiver cursos, avisa o usuário
      if (corpoTabela.length === 0) {
        alert('Nenhum curso para imprimir com as opções selecionadas.');
        return;
      }
    
      // 4. GERAR O PDF
      doc.autoTable({
        head: cabecalho,
        body: corpoTabela,
        startY: 20, // Posição inicial da tabela na página
        didDrawPage: function(data) {
          // Adiciona um título ao documento
          doc.setFontSize(16);
          doc.text("Relação de Cursos Selecionados", data.settings.margin.left, 15);
        },
        // Estilo para as linhas alternadas (zebra)
        styles: {
          fontSize: 8,
          cellPadding: 2,
        },
        alternateRowStyles: {
          fillColor: [245, 245, 245] // Cinza claro
        }
      });
    
      // Fecha o modal e salva o arquivo
      fecharModal('print-modal');
      doc.save('minha-lista-de-cursos.pdf');
    }
  
</script>
</body>
</html>
