<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Cat√°logo de Cursos Superiores Gratuitos no ES</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />

  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background-color: #f4f9ff;
      color: #333;
      margin: 0;
      padding: 0;
    }

    header {
      background-color: #003366;
      color: white;
      padding: 1rem;
      text-align: center;
    }

    main {
      padding: 2rem;
    }

    .filtros {
      display: flex;
      flex-wrap: wrap;
      gap: 1rem;
      margin-bottom: 2rem;
    }

    .filtros input,
    .filtros select {
      padding: 0.5rem;
      font-size: 1rem;
      border-radius: 4px;
      border: 1px solid #ccc;
    }

    .card-container {
      display: flex;       /* <-- MUDAMOS DE GRID PARA FLEX */
      flex-wrap: wrap;     /* <-- Permite que os cards quebrem a linha */
      gap: 1.5rem;
      min-height: 50vh;
    }

    }

    .card {
      background-color: white;
      border-radius: 8px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
      display: flex;
      flex-direction: column; /* Organiza o conte√∫do do card em coluna */
      flex-basis: 250px; /* Define a largura base do card (o 'minmax') */
      flex-grow: 1;      /* Permite que o card cres√ßa para preencher o espa√ßo (o '1fr') */
      flex-shrink: 1;    /* Permite que o card encolha se necess√°rio */
      overflow: hidden;
      cursor: pointer;
      transition: transform 0.2s ease,
                  opacity 0.3s ease,
                  max-height 0.3s ease 0.3s, /* Anima a altura, com delay de 0.3s */
                  padding 0.3s ease 0.3s,   /* Anima o padding, com delay de 0.3s */
                  margin 0.3s ease 0.3s;    /* Anima a margem, com delay de 0.3s */
                  border-width 0.3s ease 0.3s; /* Adicionado para a borda sumir suavemente */
      opacity: 1; /* Garante que ele come√ßa vis√≠vel */
      max-height: 500px; /* Um valor inicial alto para a anima√ß√£o funcionar */
    }

    .card:hover {
      transform: scale(1.03);
    }

    .card img {
      width: 100%;
      height: 140px;
      object-fit: cover;
    }

    .card-content {
      padding: 1rem;
      flex-grow: 1; /* <-- ESTA √â A PROPRIEDADE M√ÅGICA QUE IGUALA AS ALTURAS */
    }

    .card-content h2 {
      font-size: 1.1rem;
      margin: 0 0 0.5rem;
    }

    .card-content p {
      font-size: 0.95rem;
      margin: 0;
    }
    
    .card-icon {
      font-size: 64px; /* Tamanho do √≠cone */
      color: #003366; /* Cor do √≠cone (azul escuro) */
      text-align: center;
      padding: 1rem 0;
      display: block;
    }
    
    .modal {
      display: none;
      position: fixed;
      z-index: 1000;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      overflow-y: auto;
      background-color: rgba(0,0,0,0.8);
    }

    .modal-content {
      background-color: #fff;
      margin: 5% auto;
      padding: 2rem;
      max-width: 600px;
      border-radius: 10px;
      position: relative;
    }

    .close {
      color: #aaa;
      position: absolute;
      top: 10px;
      right: 20px;
      font-size: 1.5rem;
      cursor: pointer;
    }

    iframe {
      width: 100%;
      height: 315px;
      border: none;
      margin-top: 1rem;
    }

    @media (max-width: 600px) {
      iframe {
        height: 200px;
      }
    }
     @media (max-width: 600px) { /* Esta √© a media query para telas menores que 600px */
¬† ¬† ¬† iframe {
¬† ¬† ¬† ¬† height: 200px;
¬† ¬† ¬† }

      .card-container {
        grid-template-columns: repeat(2, 1fr); /* 2 colunas */
        gap: 1rem; /* Espa√ßamento entre os cards */
      }

      /* Ajustes opcionais para o conte√∫do dos cards em telas menores */
      .card-content h2 {
        font-size: 1rem; /* Fonte menor para o t√≠tulo */
      }
      .card-content p {
        font-size: 0.85rem; /* Fonte menor para os par√°grafos */
      }
¬† ¬† }

      /* --- ESTILOS PARA O MODO ELIMINE E FAVORITE --- */
      
      /* Esconde as a√ß√µes do card por padr√£o */
      .card-actions {
        display: none;
        justify-content: space-around;
        padding: 0.5rem 0;
        border-top: 1px solid #eee; /* Uma linha para separar */
        margin-top: 0.5rem;
      }
      /* MOSTRA as a√ß√µes quando o modo est√° ativo */
      body.modo-edicao-ativo .card-actions {
        display: flex;
      }
      /* Estilo dos bot√µes de a√ß√£o (estrela e proibido) */
      .card-actions button {
        background: none;
        border: none;
        cursor: pointer;
        font-size: 32px; /* Tamanho grande para toque */
        color: #ccc; /* Come√ßam cinza, sem cor */
        transition: transform 0.2s ease, color 0.2s ease;
        padding: 0 1rem; /* Adiciona espa√ßo para facilitar o clique */
      }
      /* Efeito ao passar o mouse ou tocar */
      .card-actions button:hover {
        transform: scale(1.2);
      }
      /* Estilo para a estrela favoritada */
      .card-actions button.favorito-ativo .material-symbols-outlined {
        color: #ffc107; /* Amarelo ouro */
        font-variation-settings: 'FILL' 1; /* Transforma o contorno em preenchido */
      }
      
      /* --- ESTILOS DOS CONTROLES NO MENU DE FILTROS --- */
      
      /* Estilo para o bot√£o principal de ligar/desligar o modo */
      #toggle-edit-mode {
        display: flex;
        align-items: center;
        gap: 8px;
        padding: 10px 15px;
        background-color: #6c757d;
        color: white;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        font-size: 1rem;
      }
      #toggle-edit-mode.active {
        background-color: #0056b3;
      }
      /* Container para os bot√µes de Favoritos, Lixeira, etc. */
      .edit-actions-container {
        display: none; /* Escondido por padr√£o */
        gap: 10px;
        margin-left: auto; /* Empurra para a direita */
      }
      /* Mostra o container quando o modo de edi√ß√£o est√° ativo */
      body.modo-edicao-ativo .edit-actions-container {
        display: flex;
      }
      .edit-actions-container button {
        display: flex;
        align-items: center;
        gap: 8px;
        padding: 10px 15px;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        font-size: 1rem;
        background-color: #f0f0f0;
      }
      .edit-actions-container button.danger {
        background-color: #dc3545; /* Vermelho perigo */
        color: white;
      }

      .container-lista {
        max-height: 60vh;
        overflow-y: auto;
        margin-top: 1rem;
      }
      .card-lista {
        display: flex;
        align-items: center;
        padding: 0.5rem;
        border-bottom: 1px solid #eee;
      }
      .card-content-lista {
        flex-grow: 1;
      }
      .card-content-lista h2 {
        font-size: 1rem;
        margin: 0;
      }
      .card-content-lista p {
        font-size: 0.9rem;
        margin: 0;
      }
      .card-icon-lista {
        margin-right: 1rem;
        color: #003366;
      }
      .card-actions-lista button {
          background: none;
          border: none;
          cursor: pointer;
          font-size: 1.5rem;
      }
      .card.eliminado {
        transform: scale(0.95); /* Efeito de encolher um pouco */
        opacity: 0;            /* Efeito de desaparecer (fade-out) */
        pointer-events: none;  /* Impede que o usu√°rio clique no card enquanto ele some */
        max-height: 0;
        padding-top: 0;
        padding-bottom: 0;
        margin-top: 0;
        margin-bottom: 0;
        border-width: 0; /* Remove a borda para um colapso perfeito */
      }
  </style>
</head>
<body>
  <header>
    <h1 id="site-title">Guia de Cursos Superiores Gratuitos no ES</h1>
  </header>

  <main>
    <section class="filtros" aria-label="Filtros de busca">
        <input type="text" id="busca" placeholder="Nome do curso" aria-label="Busca por nome do curso">
        <select id="instituicao" aria-label="Institui√ß√£o">
          <option value="">Todas as institui√ß√µes</option>
          <option value="UFES">UFES</option>
          <option value="IFES">IFES</option>
        </select>
        <select id="tipo" aria-label="Tipo de curso">
          <option value="">Todos os tipos</option>
          <option value="Licenciatura">Licenciatura</option>
          <option value="Bacharelado">Bacharelado</option>
        </select>
        <select id="campus" aria-label="Campus">
          <option value="">Todos os campi</option>
        </select>
        <select id="duracao" aria-label="Dura√ß√£o">
          <option value="">Todas as dura√ß√µes</option>
          <option value="8">8 semestres</option>
          <option value="9">9 semestres</option>
          <option value="10">10 semestres</option>
        </select>
    
        <button id="toggle-edit-mode">
          <span class="material-symbols-outlined">tune</span>
          Elimine e Favorite
        </button>
    
        <div id="edit-actions" class="edit-actions-container">
          <button id="show-favorites">‚≠ê Favoritos</button>
          <button id="show-eliminated">üóëÔ∏è Lixeira</button>
          <button id="clear-lists" class="danger">Limpar Tudo</button>
        </div>
    </section>

    <p id="contador-cursos" style="font-weight:bold; margin-bottom:1rem;">Exibindo 0 cursos com os filtros selecionados</p>
    
    <section id="cards" class="card-container" aria-label="Lista de cursos"></section>
    <div id="loader" style="text-align:center; display:none; margin:2rem 0; font-style:italic; color:#555;">
      Carregando mais cursos...
    </div>

  </main>

  <div id="modals"></div>

<script>
    // Vari√°veis globais para controlar o estado da p√°gina
    let cursos = [];
    let cursosFiltrados = [];
    let offset = 0;
    const limit = 20;
    let carregando = false;
    let modoEdicaoAtivo = false;

    // --- FUN√á√ïES DE RENDERIZA√á√ÉO E UI (Todas juntas e organizadas) ---

    function criarCard(curso) {
        const nomeIcone = getIconeParaCurso(curso.Curso);
        const classeFavorito = curso.isFavorito ? 'favorito-ativo' : '';
        const iconeEstrela = curso.isFavorito ? 'star' : 'star_border';
        return `
    <article class="card" id="card-${curso.id}">
      <div class="card-clickable-area" onclick="abrirModal('modal-${curso.id}')">
        <span class="material-symbols-outlined card-icon">${nomeIcone}</span>
        <div class="card-content">
          <h2>${curso.Curso}</h2>
          <p><strong>Campus:</strong> ${curso.Campus}</p>
          <p><strong>Tipo:</strong> ${curso.Tipo}</p>
          <p><strong>Dura√ß√£o:</strong> ${curso.Semestres} semestres</p>
        </div>
      </div>
      <div class="card-actions">
        <button title="Favoritar curso" class="${classeFavorito}" onclick="toggleFavorito(${curso.id})">
          <span class="material-symbols-outlined">${iconeEstrela}</span>
        </button>
        <button title="Eliminar curso" onclick="toggleEliminado(${curso.id})">üö´</button>
      </div>
    </article>`;
    }

    function criarModal(curso) {
        return `
    <div id="modal-${curso.id}" class="modal">
      <div class="modal-content">
        <span class="close" onclick="fecharModal('modal-${curso.id}')">&times;</span>
        <h2>${curso.Curso}</h2>
        <p><strong>Tipo:</strong> ${curso.Tipo}</p>
        <p><strong>Institui√ß√£o:</strong> ${curso.Instituicao || "UFES"}</p>
        <p><strong>Campus:</strong> ${curso.Campus}</p>
        <p><strong>Hor√°rio:</strong> ${curso.Hor√°rio}</p>
        <p><strong>Acesso:</strong> ${curso["Forma de acesso"]}</p>
        <a href="${curso["P√°gina do curso"]}" target="_blank">Visitar a p√°gina do curso</a>
        ${curso.VideoID ? `<iframe data-src="https://www.youtube.com/embed/${curso.VideoID}" title="YouTube video player" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>` : ''}
      </div>
    </div>`;
    }

    function abrirModal(modalId) {
        const modal = document.getElementById(modalId);
        if (!modal) return;
        const iframe = modal.querySelector('iframe');
        if (iframe && !iframe.src) {
            iframe.src = iframe.getAttribute('data-src');
        }
        modal.style.display = "block";
    }

    function fecharModal(modalId) {
        const modal = document.getElementById(modalId);
        if (!modal) return;
        if (modalId === 'lista-modal') {
            modal.remove();
        } else {
            const iframe = modal.querySelector('iframe');
            if (iframe) {
                iframe.src = "";
            }
            modal.style.display = "none";
        }
    }

    function atualizarContagem() {
        const contador = document.getElementById('contador-cursos');
        const exibidos = document.getElementById('cards').childElementCount;
        contador.textContent = `Exibindo ${exibidos} de ${cursosFiltrados.length} cursos com os filtros selecionados`;
    }

    // --- FUN√á√ïES DE L√ìGICA E DADOS ---

    function renderizarMaisCursos() {
        if (carregando || offset >= cursosFiltrados.length) {
            return;
        }
        carregando = true;
        document.getElementById('loader').style.display = "block";
        setTimeout(() => {
            const proxCursos = cursosFiltrados.slice(offset, offset + limit);
            let cardsHTML = '';
            let modalsHTML = '';
            proxCursos.forEach(curso => {
                cardsHTML += criarCard(curso);
                modalsHTML += criarModal(curso);
            });
            document.getElementById('cards').insertAdjacentHTML('beforeend', cardsHTML);
            document.getElementById('modals').insertAdjacentHTML('beforeend', modalsHTML);
            offset += proxCursos.length;
            atualizarContagem();
            document.getElementById('loader').style.display = "none";
            carregando = false;
            // Agora apenas chama nossa nova fun√ß√£o centralizada
            verificarECarregarMaisSeNecessario();
          }, 300);
    }

    function verificarECarregarMaisSeNecessario() {
      // Usamos um pequeno delay para garantir que o navegador j√° recalculou o layout
      setTimeout(() => {
        const temBarraDeRolagem = document.documentElement.scrollHeight > window.innerHeight;
        if (!temBarraDeRolagem && offset < cursosFiltrados.length && !carregando) {
          renderizarMaisCursos();
        }
      }, 400); // Um delay um pouco maior ap√≥s a anima√ß√£o de remo√ß√£o
    }
  
    function filtrarCursos() {
        const texto = document.getElementById('busca').value.toLowerCase();
        const inst = document.getElementById('instituicao').value;
        const tipo = document.getElementById('tipo').value;
        const campus = document.getElementById('campus').value;
        const duracao = document.getElementById('duracao').value;
        cursosFiltrados = cursos.filter(curso => {
            if (modoEdicaoAtivo && curso.isEliminado) {
                return false;
            }
            const instituicaoCurso = curso.Instituicao || "UFES";
            return (
                curso.Curso.toLowerCase().includes(texto) &&
                (inst === "" || instituicaoCurso === inst) &&
                (tipo === "" || curso.Tipo === tipo) &&
                (campus === "" || curso.Campus === campus) &&
                (duracao === "" || curso.Semestres.toString() === duracao)
            );
        });
        offset = 0;
        document.getElementById('cards').innerHTML = "";
        document.getElementById('modals').innerHTML = "";
        renderizarMaisCursos();
    }

    function getIconeParaCurso(nomeDoCurso) {
        const nome = nomeDoCurso.toUpperCase();
        if (nome.includes('ENGENHARIA')) return 'engineering';
        if (nome.includes('COMPUTA√á√ÉO') || nome.includes('SISTEMAS')) return 'computer';
        if (nome.includes('DIREITO')) return 'gavel';
        if (nome.includes('MEDICINA')) return 'local_hospital';
        if (nome.includes('ARQUITETURA')) return 'architecture';
        if (nome.includes('QU√çMICA')) return 'science';
        if (nome.includes('F√çSICA')) return 'calculate';
        if (nome.includes('BIOL√ìGICAS') || nome.includes('BIOLOGIA')) return 'biotech';
        if (nome.includes('MATEM√ÅTICA')) return 'functions';
        if (nome.includes('LETRAS')) return 'translate';
        if (nome.includes('PEDAGOGIA') || nome.includes('EDUCA√á√ÉO')) return 'school';
        if (nome.includes('HIST√ìRIA')) return 'history_edu';
        if (nome.includes('GEOGRAFIA')) return 'public';
        if (nome.includes('FILOSOFIA')) return 'psychology';
        if (nome.includes('ARTES')) return 'palette';
        if (nome.includes('M√öSICA')) return 'music_note';
        if (nome.includes('ADMINISTRA√á√ÉO') || nome.includes('CI√äNCIAS CONT√ÅBEIS')) return 'account_balance';
        if (nome.includes('ECON√îMICAS') || nome.includes('ECONOMIA')) return 'trending_up';
        if (nome.includes('JORNALISMO') || nome.includes('COMUNICA√á√ÉO')) return 'newspaper';
        if (nome.includes('FARM√ÅCIA')) return 'medication';
        if (nome.includes('NUTRI√á√ÉO')) return 'nutrition';
        if (nome.includes('PSICOLOGIA')) return 'neurology';
        if (nome.includes('AGRONOMIA')) return 'eco';
        return 'book_4';
    }

    // --- FUN√á√ïES PARA O MODO "ELIMINE E FAVORITE" ---

    function toggleFavorito(cursoId) {
        const curso = cursos.find(c => c.id === cursoId);
        if (!curso) return;
        curso.isFavorito = !curso.isFavorito;
        const cardButton = document.querySelector(`#card-${cursoId} .card-actions button:nth-child(1)`);
        if (cardButton) {
            const starIcon = cardButton.querySelector('.material-symbols-outlined');
            cardButton.classList.toggle('favorito-ativo', curso.isFavorito);
            starIcon.textContent = curso.isFavorito ? 'star' : 'star_border';
        }
    }

    function toggleEliminado(cursoId) {
        const curso = cursos.find(c => c.id === cursoId);
        if (!curso) return;
        // 1. Atualiza o estado dos dados em segundo plano
        curso.isEliminado = !curso.isEliminado;
        // 2. Encontra o card na tela
        const cardElement = document.getElementById(`card-${cursoId}`);
        if (cardElement) {
            // 3. Adiciona ou remove a classe 'eliminado' para ativar a anima√ß√£o do CSS
            cardElement.classList.toggle('eliminado', curso.isEliminado);
        }
      // Ap√≥s eliminar, chama a verifica√ß√£o para carregar mais se a barra de rolagem sumiu
      verificarECarregarMaisSeNecessario();
    }

    function abrirModalDeLista(titulo, listaDeCursos, isLixeira = false) {
        const modalAntigo = document.getElementById('lista-modal');
        if (modalAntigo) modalAntigo.remove();
        let cardsHTML = '';
        if (listaDeCursos.length === 0) {
            cardsHTML = '<p>Nenhum curso aqui. A lista est√° vazia.</p>';
        } else {
            listaDeCursos.forEach(curso => {
                const nomeIcone = getIconeParaCurso(curso.Curso);
                const acaoBotao = isLixeira ?
                    `<button title="Restaurar curso" onclick="restaurarCursoDaLixeira(${curso.id})">‚ôªÔ∏è Restaurar</button>` :
                    `<button title="Remover dos favoritos" onclick="removerFavoritoDaLista(${curso.id})">‚≠ê</button>`;
                cardsHTML += `
            <article class="card-lista" id="lista-card-${curso.id}">
              <span class="material-symbols-outlined card-icon-lista">${nomeIcone}</span>
              <div class="card-content-lista"><h2>${curso.Curso}</h2><p>${curso.Campus}</p></div>
              <div class="card-actions-lista">${acaoBotao}</div>
            </article>`;
            });
        }
        const modalHTML = `
        <div id="lista-modal" class="modal" style="display:block;">
          <div class="modal-content"><span class="close" onclick="fecharModal('lista-modal')">&times;</span>
            <h2>${titulo}</h2><div class="container-lista">${cardsHTML}</div>
          </div>
        </div>`;
        document.body.insertAdjacentHTML('beforeend', modalHTML);
    }

    function removerFavoritoDaLista(cursoId) {
        toggleFavorito(cursoId);
        const cardNaLista = document.getElementById(`lista-card-${cursoId}`);
        if (cardNaLista) cardNaLista.remove();
    }

    function restaurarCursoDaLixeira(cursoId) {
        toggleEliminado(cursoId);
        const cardNaLista = document.getElementById(`lista-card-${cursoId}`);
        if (cardNaLista) cardNaLista.remove();
    }


    // --- INICIALIZA√á√ÉO DA P√ÅGINA ---
    document.addEventListener('DOMContentLoaded', () => {
        fetch('dados_cursos_ufes_atualizado.json')
            .then(response => response.json())
            .then(data => {
                data.sort((a, b) => a.Curso.localeCompare(b.Curso));
                cursos = data.map((curso, index) => ({...curso, id: index, isFavorito: false, isEliminado: false}));
                cursosFiltrados = [...cursos];
                
                const campusSelect = document.getElementById('campus');
                [...new Set(cursos.map(c => c.Campus).filter(c => c))].sort().forEach(c => {
                    const opt = document.createElement('option');
                    opt.value = c; opt.textContent = c;
                    campusSelect.appendChild(opt);
                });

                // Adiciona os 'escutadores' de eventos para os filtros
                document.getElementById('busca').addEventListener('input', filtrarCursos);
                document.getElementById('instituicao').addEventListener('change', filtrarCursos);
                document.getElementById('tipo').addEventListener('change', filtrarCursos);
                document.getElementById('campus').addEventListener('change', filtrarCursos);
                document.getElementById('duracao').addEventListener('change', filtrarCursos);

                // Adiciona os 'escutadores' de eventos para o MODO DE EDI√á√ÉO
                const toggleButton = document.getElementById('toggle-edit-mode');
                toggleButton.addEventListener('click', () => {
                    modoEdicaoAtivo = !modoEdicaoAtivo;
                    document.body.classList.toggle('modo-edicao-ativo');
                    toggleButton.classList.toggle('active');
                    filtrarCursos();
                });
                document.getElementById('show-favorites').addEventListener('click', () => {
                    const favoritos = cursos.filter(c => c.isFavorito);
                    abrirModalDeLista('Meus Favoritos', favoritos);
                });
                document.getElementById('show-eliminated').addEventListener('click', () => {
                    const eliminados = cursos.filter(c => c.isEliminado);
                    abrirModalDeLista('Cursos na Lixeira', eliminados, true);
                });
                document.getElementById('clear-lists').addEventListener('click', () => {
                    if (confirm('Tem certeza que deseja limpar suas listas? Esta a√ß√£o n√£o pode ser desfeita.')) {
                        cursos.forEach(c => { c.isFavorito = false; c.isEliminado = false; });
                        filtrarCursos();
                    }
                });
                
                renderizarMaisCursos(); // Carrega o primeiro lote de cursos
            })
            .catch(error => console.error('Erro fatal:', error));

        // Listeners Globais
        window.onclick = function(event) {
            if (event.target.id === 'lista-modal') {
                fecharModal('lista-modal');
            } else if (event.target.classList.contains('modal')) {
                fecharModal(event.target.id);
            }
        };
        window.addEventListener("scroll", () => {
            const nearBottom = window.innerHeight + window.scrollY >= document.documentElement.scrollHeight - 200;
            if (nearBottom && !carregando && offset < cursosFiltrados.length) {
                renderizarMaisCursos();
            }
        });
    });
</script>
</body>
</html>
