<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Guia de Cursos Superiores no ES - Com Filtros</title>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background-color: #f4f9ff;
      color: #333;
      margin: 0;
      padding: 0;
    }

    header {
      background-color: #003366;
      color: white;
      padding: 1rem;
      text-align: center;
    }

    main {
      padding: 2rem;
    }

    .filtros {
      display: flex;
      flex-wrap: wrap;
      gap: 1rem;
      margin-bottom: 2rem;
    }

    .filtros input,
    .filtros select {
      padding: 0.5rem;
      font-size: 1rem;
      border-radius: 4px;
      border: 1px solid #ccc;
    }

    .card-container {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
      gap: 1.5rem;
      min-height: 50vh; /* altura mínima para não disparar o scroll quando aplicar um filtro */

    }

    .card {
      background-color: white;
      border-radius: 8px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
      overflow: hidden;
      cursor: pointer;
      transition: transform 0.2s ease;
    }

    .card:hover {
      transform: scale(1.03);
    }

    .card img {
      width: 100%;
      height: 140px;
      object-fit: cover;
    }

    .card-content {
      padding: 1rem;
    }

    .card-content h2 {
      font-size: 1.1rem;
      margin: 0 0 0.5rem;
    }

    .card-content p {
      font-size: 0.95rem;
      margin: 0;
    }

    .modal {
      display: none;
      position: fixed;
      z-index: 1000;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      overflow-y: auto;
      background-color: rgba(0,0,0,0.8);
    }

    .modal-content {
      background-color: #fff;
      margin: 5% auto;
      padding: 2rem;
      max-width: 600px;
      border-radius: 10px;
      position: relative;
    }

    .close {
      color: #aaa;
      position: absolute;
      top: 10px;
      right: 20px;
      font-size: 1.5rem;
      cursor: pointer;
    }

    iframe {
      width: 100%;
      height: 315px;
      border: none;
      margin-top: 1rem;
    }

    @media (max-width: 600px) {
      iframe {
        height: 200px;
      }
    }
     @media (max-width: 600px) { /* Esta é a media query para telas menores que 600px */
      iframe {
        height: 200px;
      }

      .card-container {
        grid-template-columns: repeat(2, 1fr); /* 2 colunas */
        gap: 1rem; /* Espaçamento entre os cards */
      }

      /* Ajustes opcionais para o conteúdo dos cards em telas menores */
      .card-content h2 {
        font-size: 1rem; /* Fonte menor para o título */
      }
      .card-content p {
        font-size: 0.85rem; /* Fonte menor para os parágrafos */
      }
    }
  </style>
</head>
<body>
  <header>
    <h1 id="site-title">Guia de Cursos Superiores Gratuitos no ES</h1>
  </header>

  <main>
    <section class="filtros" aria-label="Filtros de busca">
      <input type="text" id="busca" placeholder="Buscar por nome do curso" />
      <select id="instituicao">
        <option value="">Todas as instituições</option>
        <option value="UFES">UFES</option>
        <option value="IFES">IFES</option>
      </select>
      <select id="tipo">
        <option value="">Todos os tipos</option>
        <option value="Licenciatura">Licenciatura</option>
        <option value="Bacharelado">Bacharelado</option>
      </select>
      <select id="campus">
        <option value="">Todos os campi</option>
      </select>
      <select id="duracao">
        <option value="">Todas as durações</option>
        <option value="8">8 semestres</option>
        <option value="9">9 semestres</option>
        <option value="10">10 semestres</option>
      </select>
    </section>

    <p id="contador-cursos" style="font-weight:bold; margin-bottom:1rem;">Exibindo 0 cursos com os filtros selecionados</p>
    
    <section id="cards" class="card-container" aria-label="Lista de cursos"></section>
    <div id="loader" style="text-align:center; display:none; margin:2rem 0; font-style:italic; color:#555;">
      Carregando mais cursos...
    </div>

  </main>

  <div id="modals"></div>

<script>
    // Variáveis globais para controlar o estado da página
    let cursos = []; // Armazenará todos os cursos do JSON
    let cursosFiltrados = []; // Armazenará os cursos que correspondem aos filtros
    let offset = 0; // Controla a paginação (quantos cursos já foram carregados)
    const limit = 20; // Quantos cursos carregar por vez
    let carregando = false; // Flag para evitar carregamentos múltiplos simultâneos

    // --- FUNÇÕES DE RENDERIZAÇÃO E UI ---

    // Função que cria o HTML de um card de curso
    function criarCard(curso) {
      // Define a instituição e o logo correspondente
      const instituicao = curso.Instituicao || "UFES";
      const logo = instituicao === "IFES" ? 'https://upload.wikimedia.org/wikipedia/commons/thumb/3/3f/Ifes_vertical_logo.svg/1200px-Ifes_vertical_logo.svg.png' : 'https://upload.wikimedia.org/wikipedia/commons/thumb/d/d4/Ufes_brasão.png/1200px-Ufes_brasão.png';
    
      // Retorna o HTML do card, usando o ID único no onclick e o logo no src da imagem
      return `
        <article class="card" onclick="abrirModal('modal-${curso.id}')">
          <img src="${logo}" alt="Logo ${instituicao}">
          <div class="card-content">
            <h2>${curso.Curso}</h2>
            <p><strong>Campus:</strong> ${curso.Campus}</p>
            <p><strong>Tipo:</strong> ${curso.Tipo}</p>
            <p><strong>Duração:</strong> ${curso.Semestres} semestres</p>
          </div>
        </article>
      `;
    }

    // Função que cria o HTML de um modal de detalhes do curso
    function criarModal(curso) {
      return `
        <div id="modal-${curso.id}" class="modal">
          <div class="modal-content">
            <span class="close" onclick="fecharModal('modal-${curso.id}')">&times;</span>
            <h2>${curso.Curso}</h2>
            <p><strong>Tipo:</strong> ${curso.Tipo}</p>
            <p><strong>Instituição:</strong> ${curso.Instituicao || "UFES"}</p>
            <p><strong>Campus:</strong> ${curso.Campus}</p>
            <p><strong>Horário:</strong> ${curso.Horário}</p>
            <p><strong>Acesso:</strong> ${curso["Forma de acesso"]}</p>
            <a href="${curso["Página do curso"]}" target="_blank">Visitar a página do curso</a>
            ${curso.VideoID ? `<iframe data-src="https://www.youtube.com/embed/${curso.VideoID}" title="YouTube video player" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>` : ''}
          </div>
        </div>
      `;
    }

    // Funções para abrir e fechar o modal
    function abrirModal(modalId) {
      const modal = document.getElementById(modalId);
      if (!modal) return;

      const iframe = modal.querySelector('iframe');
      // Carrega o vídeo apenas quando o modal é aberto pela primeira vez
      if (iframe && !iframe.src) {
        iframe.src = iframe.getAttribute('data-src');
      }
      modal.style.display = "block";
    }

    function fecharModal(modalId) {
      const modal = document.getElementById(modalId);
      if (!modal) return;

      const iframe = modal.querySelector('iframe');
      // Para a execução do vídeo ao fechar o modal
      if (iframe) {
        iframe.src = ""; // Limpa o src para parar o vídeo
      }
      modal.style.display = "none";
    }

    // Atualiza o texto que informa quantos cursos estão sendo exibidos
    function atualizarContagem() {
      const contador = document.getElementById('contador-cursos');
      const exibidos = document.getElementById('cards').childElementCount;
      contador.textContent = `Exibindo ${exibidos} de ${cursosFiltrados.length} cursos com os filtros selecionados`;
    }

    // --- FUNÇÕES DE LÓGICA E DADOS ---

    // Substitua a sua função antiga por esta versão mais inteligente
    function renderizarMaisCursos() {
      // Se já estiver carregando ou se não houver mais cursos, não faz nada
      if (carregando || offset >= cursosFiltrados.length) {
        return;
      }
      carregando = true;
      document.getElementById('loader').style.display = "block";
    
      // Um pequeno delay para a percepção de carregamento ser suave
      setTimeout(() => {
        const proxCursos = cursosFiltrados.slice(offset, offset + limit);
    
        // Prepara o HTML para ser adicionado
        let cardsHTML = '';
        let modalsHTML = '';
        proxCursos.forEach(curso => {
          cardsHTML += criarCard(curso);
          modalsHTML += criarModal(curso);
        });
    
        // Adiciona o HTML de uma só vez (mais eficiente), e sem jogar tudo fora (ficava piscando)
        document.getElementById('cards').insertAdjacentHTML('beforeend', cardsHTML);
        document.getElementById('modals').insertAdjacentHTML('beforeend', modalsHTML);
    
        offset += proxCursos.length; // Atualiza o offset
    
        // Finaliza o processo de renderização atual
        atualizarContagem();
        document.getElementById('loader').style.display = "none";
        carregando = false; // Libera a trava de carregamento
    
        // --- LÓGICA PROATIVA ADICIONADA AQUI ---
        // Após terminar, verifica se a tela já foi preenchida.
        // Usamos um mínimo delay para dar tempo do navegador redesenhar a página.
        setTimeout(() => {
          const temBarraDeRolagem = document.documentElement.scrollHeight > window.innerHeight;
          
          // Se NÃO tem barra de rolagem E ainda existem cursos a serem mostrados...
          if (!temBarraDeRolagem && offset < cursosFiltrados.length) {
            // ...chama a si mesma para carregar o próximo lote.
            renderizarMaisCursos();
          }
        }, 100);
    
      }, 300); // Delay principal, para o "Carregando..." aparecer
    }

    // Filtra os cursos com base nos inputs do usuário
    function filtrarCursos() {
      const texto = document.getElementById('busca').value.toLowerCase();
      const inst = document.getElementById('instituicao').value;
      const tipo = document.getElementById('tipo').value;
      const campus = document.getElementById('campus').value;
      const duracao = document.getElementById('duracao').value;

      cursosFiltrados = cursos.filter(curso => {
        const instituicaoCurso = curso.Instituicao || "UFES";
        return (
          curso.Curso.toLowerCase().includes(texto) &&
          (inst === "" || instituicaoCurso === inst) &&
          (tipo === "" || curso.Tipo === tipo) &&
          (campus === "" || curso.Campus === campus) &&
          (duracao === "" || curso.Semestres.toString() === duracao)
        );
      });

      // Reseta a visualização para exibir os novos resultados do zero
      offset = 0;
      document.getElementById('cards').innerHTML = "";
      document.getElementById('modals').innerHTML = "";
      
      renderizarMaisCursos(); // Renderiza o primeiro lote de cursos filtrados
    }

    // --- INICIALIZAÇÃO DA PÁGINA ---

    // Ponto de entrada: carrega os dados do JSON e prepara a página
    document.addEventListener('DOMContentLoaded', () => {
      fetch('dados_cursos_ufes_atualizado.json')
        .then(response => {
            if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
            }
            return response.json();
        })
        .then(data => {
          // 1. PRIMEIRO, ordene o array de dados brutos
          data.sort((a, b) => a.Curso.localeCompare(b.Curso));
      
          // 2. DEPOIS, crie o array 'cursos' com os IDs agora sequenciais
          cursos = data.map((curso, index) => ({ ...curso, id: index }));
          
          cursosFiltrados = [...cursos];
          
          // Preenche o filtro de campus com opções únicas do JSON
          const campusSelect = document.getElementById('campus');
          const campi = [...new Set(cursos.map(c => c.Campus).filter(c => c))].sort();
          campi.forEach(c => {
            const opt = document.createElement('option');
            opt.value = c;
            opt.textContent = c;
            campusSelect.appendChild(opt);
          });

          // Adiciona os 'escutadores' de eventos para os filtros
          document.getElementById('busca').addEventListener('input', filtrarCursos);
          document.getElementById('instituicao').addEventListener('change', filtrarCursos);
          document.getElementById('tipo').addEventListener('change', filtrarCursos);
          document.getElementById('campus').addEventListener('change', filtrarCursos);
          document.getElementById('duracao').addEventListener('change', filtrarCursos);

          // Carrega o primeiro lote de cursos
          renderizarMaisCursos();
        })
        .catch(error => {
          console.error('Erro fatal ao carregar dados:', error);
          document.getElementById('cards').innerHTML = `<p style='color: red;'><strong>Erro:</strong> Não foi possível carregar os dados dos cursos. Verifique se o arquivo 'dados_cursos_ufes_atualizado.json' está na mesma pasta.</p>`;
        });

      // Evento para fechar modal clicando fora
      window.onclick = function(event) {
        if (event.target.classList.contains('modal')) {
          fecharModal(event.target.id);
        }
      };
      
      // Evento para carregar mais cursos com a rolagem
      window.addEventListener("scroll", () => {
        // Condição para carregar mais: não estar carregando, ter mais cursos para mostrar, e estar perto do fim
        const nearBottom = window.innerHeight + window.scrollY >= document.documentElement.scrollHeight - 200;
        if (nearBottom && !carregando && offset < cursosFiltrados.length) {
          renderizarMaisCursos();
        }
      });
    });
</script>
</body>
</html>
